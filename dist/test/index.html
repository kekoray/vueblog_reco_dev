<!DOCTYPE html>
<html lang="zh-CN">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <title>spark | KKlife</title>
    <meta name="generator" content="VuePress 1.9.7">
    <link rel="icon" href="/logo.jpg">
    <meta name="description" content="Just playing around">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    
    <link rel="preload" href="/assets/css/0.styles.13a93934.css" as="style"><link rel="preload" href="/assets/js/app.b82542a7.js" as="script"><link rel="preload" href="/assets/js/3.3eaabea3.js" as="script"><link rel="preload" href="/assets/js/1.67511a4e.js" as="script"><link rel="preload" href="/assets/js/18.74b5b17a.js" as="script"><link rel="prefetch" href="/assets/js/10.403d62e8.js"><link rel="prefetch" href="/assets/js/11.1a366580.js"><link rel="prefetch" href="/assets/js/12.c8ccc8b1.js"><link rel="prefetch" href="/assets/js/13.7660a114.js"><link rel="prefetch" href="/assets/js/14.638d304c.js"><link rel="prefetch" href="/assets/js/15.b9aed218.js"><link rel="prefetch" href="/assets/js/16.4e6c5e2b.js"><link rel="prefetch" href="/assets/js/17.02d96f9d.js"><link rel="prefetch" href="/assets/js/19.f3eb4831.js"><link rel="prefetch" href="/assets/js/20.50e68df4.js"><link rel="prefetch" href="/assets/js/4.38a9c230.js"><link rel="prefetch" href="/assets/js/5.ccf1af58.js"><link rel="prefetch" href="/assets/js/6.8d327fe4.js"><link rel="prefetch" href="/assets/js/7.209464bc.js"><link rel="prefetch" href="/assets/js/8.927bab3b.js"><link rel="prefetch" href="/assets/js/9.823ab4cc.js">
    <link rel="stylesheet" href="/assets/css/0.styles.13a93934.css">
  </head>
  <body>
    <div id="app" data-server-rendered="true"><div class="theme-container" data-v-7dd95ae2><div data-v-7dd95ae2><div class="password-shadow password-wrapper-out" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88>KKlife</h3> <p class="description" data-v-59e6cb88>Just playing around</p> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><span data-v-59e6cb88>Koray</span>
          
        <span data-v-59e6cb88>2021 - </span>
        2023
      </a></span></div></div> <div class="hide" data-v-7dd95ae2><header class="navbar" data-v-7dd95ae2><div class="sidebar-button"><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" role="img" viewBox="0 0 448 512" class="icon"><path fill="currentColor" d="M436 124H12c-6.627 0-12-5.373-12-12V80c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12zm0 160H12c-6.627 0-12-5.373-12-12v-32c0-6.627 5.373-12 12-12h424c6.627 0 12 5.373 12 12v32c0 6.627-5.373 12-12 12z"></path></svg></div> <a href="/" class="home-link router-link-active"><img src="/logo.jpg" alt="KKlife" class="logo"> <span class="site-name">KKlife</span></a> <div class="links"><div class="color-picker"><a class="color-button"><i class="iconfont reco-color"></i></a> <div class="color-picker-menu" style="display:none;"><div class="mode-options"><h4 class="title">Choose mode</h4> <ul class="color-mode-options"><li class="dark">dark</li><li class="auto active">auto</li><li class="light">light</li></ul></div></div></div> <div class="search-box"><input aria-label="Search" autocomplete="off" spellcheck="false" value=""> <!----></div> <nav class="nav-links can-hide"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/category1/" class="nav-link"><i class="undefined"></i>
  category1
</a></li><li class="dropdown-item"><!----> <a href="/categories/category2/" class="nav-link"><i class="undefined"></i>
  category2
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Docs
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/theme-reco/" class="nav-link"><i class="undefined"></i>
  vuepress-reco
</a></li><li class="dropdown-item"><!----> <a href="/docs/theme-reco/" class="nav-link"><i class="undefined"></i>
  vuepress2
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Contact
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/recoluan" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav></div></header> <div class="sidebar-mask" data-v-7dd95ae2></div> <aside class="sidebar" data-v-7dd95ae2><div class="personal-info-wrapper" data-v-1fad0c41 data-v-7dd95ae2><img src="/logo2.jpg" alt="author-avatar" class="personal-img" data-v-1fad0c41> <h3 class="name" data-v-1fad0c41>
    Koray
  </h3> <div class="num" data-v-1fad0c41><div data-v-1fad0c41><h3 data-v-1fad0c41>9</h3> <h6 data-v-1fad0c41>文章</h6></div> <div data-v-1fad0c41><h3 data-v-1fad0c41>4</h3> <h6 data-v-1fad0c41>标签</h6></div></div> <ul class="social-links" data-v-1fad0c41><li class="social-item" data-v-1fad0c41><i class="iconfont reco-github" style="color:#849b87;" data-v-1fad0c41></i></li><li class="social-item" data-v-1fad0c41><i class="iconfont reco-npm" style="color:#abbd81;" data-v-1fad0c41></i></li></ul> <hr data-v-1fad0c41></div> <nav class="nav-links"><div class="nav-item"><a href="/" class="nav-link"><i class="iconfont reco-home"></i>
  Home
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-category"></i>
      Category
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/categories/category1/" class="nav-link"><i class="undefined"></i>
  category1
</a></li><li class="dropdown-item"><!----> <a href="/categories/category2/" class="nav-link"><i class="undefined"></i>
  category2
</a></li></ul></div></div><div class="nav-item"><a href="/tag/" class="nav-link"><i class="iconfont reco-tag"></i>
  Tag
</a></div><div class="nav-item"><a href="/timeline/" class="nav-link"><i class="iconfont reco-date"></i>
  TimeLine
</a></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Docs
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="/docs/theme-reco/" class="nav-link"><i class="undefined"></i>
  vuepress-reco
</a></li><li class="dropdown-item"><!----> <a href="/docs/theme-reco/" class="nav-link"><i class="undefined"></i>
  vuepress2
</a></li></ul></div></div><div class="nav-item"><div class="dropdown-wrapper"><a class="dropdown-title"><span class="title"><i class="iconfont reco-message"></i>
      Contact
    </span> <span class="arrow right"></span></a> <ul class="nav-dropdown" style="display:none;"><li class="dropdown-item"><!----> <a href="https://github.com/recoluan" target="_blank" rel="noopener noreferrer" class="nav-link external"><i class="iconfont reco-github"></i>
  GitHub
  <span><svg xmlns="http://www.w3.org/2000/svg" aria-hidden="true" focusable="false" x="0px" y="0px" viewBox="0 0 100 100" width="15" height="15" class="icon outbound"><path fill="currentColor" d="M18.8,85.1h56l0,0c2.2,0,4-1.8,4-4v-32h-8v28h-48v-48h28v-8h-32l0,0c-2.2,0-4,1.8-4,4v56C14.8,83.3,16.6,85.1,18.8,85.1z"></path> <polygon fill="currentColor" points="45.7,48.7 51.3,54.3 77.2,28.5 77.2,37.2 85.2,37.2 85.2,14.9 62.8,14.9 62.8,22.9 71.5,22.9"></polygon></svg> <span class="sr-only">(opens new window)</span></span></a></li></ul></div></div> <!----></nav> <ul class="sidebar-links"><li><a href="/2020/05/29/theme-reco/" class="sidebar-link">theme-reco</a></li><li><a href="/2020/05/27/theme/" class="sidebar-link">theme</a></li><li><a href="/2020/05/28/plugin/" class="sidebar-link">plugin</a></li><li><a href="/test/" aria-current="page" class="active sidebar-link">spark</a></li></ul> </aside> <div class="password-shadow password-wrapper-in" style="display:none;" data-v-59e6cb88 data-v-7dd95ae2><h3 class="title" data-v-59e6cb88>spark</h3> <!----> <label id="box" class="inputBox" data-v-59e6cb88><input type="password" value="" data-v-59e6cb88> <span data-v-59e6cb88>Konck! Knock!</span> <button data-v-59e6cb88>OK</button></label> <div class="footer" data-v-59e6cb88><span data-v-59e6cb88><i class="iconfont reco-theme" data-v-59e6cb88></i> <a target="blank" href="https://vuepress-theme-reco.recoluan.com" data-v-59e6cb88>vuePress-theme-reco</a></span> <span data-v-59e6cb88><i class="iconfont reco-copyright" data-v-59e6cb88></i> <a data-v-59e6cb88><span data-v-59e6cb88>Koray</span>
          
        <span data-v-59e6cb88>2021 - </span>
        2023
      </a></span></div></div> <div data-v-7dd95ae2><div data-v-7dd95ae2><main class="page"><section style="display:;"><div class="page-title"><h1 class="title">spark</h1> <div data-v-8a445198><i class="iconfont reco-account" data-v-8a445198><span data-v-8a445198>Koray</span></i> <i class="iconfont reco-date" data-v-8a445198><span data-v-8a445198>2023/5/29</span></i> <!----> <!----></div></div> <div class="theme-reco-content content__default"><h1 id="spark"><a href="#spark" class="header-anchor">#</a> Spark</h1> <h2 id="spark概述"><a href="#spark概述" class="header-anchor">#</a> Spark概述</h2> <h3 id="spark组件"><a href="#spark组件" class="header-anchor">#</a> Spark组件</h3> <blockquote><p>Spark提供了批处理(RDDs), 结构化查询(DataFrame), 流计算(SparkStreaming), 机器学习(MLlib), 图计算(GraphX)等组件.</p> <p>==Spark最核心的功能是RDDs==,RDDs存在于<code>spark-core</code>这个包内,这个包也是Spark最核心的包.</p></blockquote> <h4 id="spark-core-和-弹性分布式数据集-rdds"><a href="#spark-core-和-弹性分布式数据集-rdds" class="header-anchor">#</a> Spark-Core 和 弹性分布式数据集(RDDs)</h4> <ul><li>Spark-Core 是整个 Spark 的基础, 提供了分布式任务调度和基本的 I/O 功能</li> <li>Spark 的基础的程序抽象是弹性分布式数据集(RDDs), 是一个可以并行操作, 有容错的数据集合
<ul><li>RDDs 可以通过引用外部存储系统的数据集创建(如HDFS, HBase), 或者通过现有的 RDDs 转换得到</li> <li>RDDs 抽象提供了 Java, Scala, Python 等语言的API</li> <li>RDDs 简化了编程复杂性, 操作 RDDs 类似通过 Scala 或者 Java8 的 Streaming 操作本地数据集合</li></ul></li></ul> <h4 id="spark-sql"><a href="#spark-sql" class="header-anchor">#</a> Spark SQL</h4> <ul><li>Spark SQL 在 <code>spark-core</code> 基础之上带出了一个名为 DataSet 和 DataFrame 的数据抽象化的概念</li> <li>Spark SQL 提供了在 Dataset 和 DataFrame 之上执行 SQL 的能力</li> <li>Spark SQL 提供了 DSL, 可以通过 Scala, Java, Python 等语言操作 DataSet 和 DataFrame</li> <li>它还支持使用 JDBC/ODBC 服务器操作 SQL 语言</li></ul> <h4 id="spark-streaming"><a href="#spark-streaming" class="header-anchor">#</a> Spark Streaming</h4> <ul><li>Spark Streaming 充分利用 <code>spark-core</code> 的快速调度能力来运行流分析</li> <li>它截取小批量的数据并可以对之运行 RDD Transformation</li> <li>它提供了在同一个程序中同时使用流分析和批量分析的能力</li></ul> <h4 id="mllib"><a href="#mllib" class="header-anchor">#</a> MLlib</h4> <ul><li>MLlib 是 Spark 上分布式机器学习的框架. Spark分布式内存的架构 比 Hadoop磁盘式 的 Apache Mahout 快上 10 倍, 扩展性也非常优良</li> <li>MLlib 可以使用许多常见的机器学习和统计算法, 简化大规模机器学习</li> <li>汇总统计, 相关性, 分层抽样, 假设检定, 随即数据生成</li> <li>支持向量机, 回归, 线性回归, 逻辑回归, 决策树, 朴素贝叶斯</li> <li>协同过滤, ALS</li> <li>K-means</li> <li>SVD奇异值分解, PCA主成分分析</li> <li>TF-IDF, Word2Vec, StandardScaler</li> <li>SGD随机梯度下降, L-BFGS</li></ul> <h4 id="graphx"><a href="#graphx" class="header-anchor">#</a> GraphX</h4> <ul><li>GraphX 是分布式图计算框架, 提供了一组可以表达图计算的 API, GraphX 还对这种抽象化提供了优化运行</li></ul> <h3 id="spark和hadoop的异同"><a href="#spark和hadoop的异同" class="header-anchor">#</a> Spark和Hadoop的异同</h3> <table><thead><tr><th></th> <th>Hadoop</th> <th>Spark</th></tr></thead> <tbody><tr><td><strong>类型</strong></td> <td>基础平台, 包含计算, 存储, 调度</td> <td>分布式计算工具</td></tr> <tr><td><strong>场景</strong></td> <td>大规模数据集上的批处理</td> <td>迭代计算, 交互式计算, 流计算</td></tr> <tr><td><strong>延迟</strong></td> <td>大</td> <td>小</td></tr> <tr><td><strong>易用性</strong></td> <td>API 较为底层, 算法适应性差</td> <td>API 较为顶层, 方便使用</td></tr> <tr><td><strong>价格</strong></td> <td>对机器要求低, 便宜</td> <td>对内存有要求, 相对较贵</td></tr></tbody></table> <h3 id="spark集群结构"><a href="#spark集群结构" class="header-anchor">#</a> Spark集群结构</h3> <ul><li><h5 id="master"><a href="#master" class="header-anchor">#</a> Master</h5> <blockquote><p>集群中的主节点, 负责总控, 调度, 管理和协调 Worker, 保留资源状况等</p></blockquote></li> <li><h5 id="driver"><a href="#driver" class="header-anchor">#</a> Driver</h5> <blockquote><p>该进程调用 Spark 程序的 main 方法, 并且启动 SparkContext.</p> <p>在Spark中由SparkContext负责和ClusterManager通信，进行资源的申请、任务的分配和监控等；当Executor部分运行完毕后，Driver负责将SparkContext关闭。通常用SparkContext代表Drive.</p></blockquote></li> <li><h5 id="cluster-manager"><a href="#cluster-manager" class="header-anchor">#</a> Cluster Manager</h5> <blockquote><p>该进程负责和外部集群工具打交道, 申请或释放集群资源.</p></blockquote></li> <li><h5 id="worker-slave"><a href="#worker-slave" class="header-anchor">#</a> Worker / Slave</h5> <blockquote><p>该进程是一个守护进程, 负责启动和管理 Executor, 定期向 Master汇报</p></blockquote></li> <li><h5 id="executor"><a href="#executor" class="header-anchor">#</a> Executor</h5> <blockquote><p>Application运行在Worker 节点上的一个进程，该进程负责运行Task，并且负责将数据存在内存或者磁盘上，每个Application都有各自独立的一批Executor</p></blockquote></li> <li><p><strong>Application</strong></p> <blockquote><p>Appliction都是指用户编写的Spark应用程序，其中包括一个Driver功能的代码和分布在集群中多个节点上运行Executor代码</p></blockquote></li> <li><p><strong>DAGScheduler</strong></p> <blockquote><p>高级调度器 ; 根据Job构建基于Stage的DAG（有向无环图)，并提交Stage给TaskScheduler.</p></blockquote></li> <li><p><strong>TaskScheduler</strong></p> <blockquote><p>任务调度器 ; 将TaskSet提交给Executor运行.</p></blockquote></li> <li><p><strong>Task</strong></p> <blockquote><p>被送到某个Executor上的工作任务 ; 是Spark中最小的独立执行单元, 其作用是处理一个RDD分区;</p></blockquote></li> <li><p><strong>Job</strong></p> <blockquote><p>程序调度运行的最大单位 , 调用Action算子的时候生成; 一个Application中往往会产生多个Job.</p></blockquote></li> <li><p><strong>Stage</strong></p> <blockquote><p>每个Job会被拆分成多组Task, 作为一个TaskSet, 也就是Stage; Stage的边界就是发生shuffle的地方.</p></blockquote></li></ul> <h2 id="spark入门"><a href="#spark入门" class="header-anchor">#</a> Spark入门</h2> <ul><li><h5 id="spark官方提供了两种方式编写代码"><a href="#spark官方提供了两种方式编写代码" class="header-anchor">#</a> Spark官方提供了两种方式编写代码</h5> <ul><li>==<strong>Spark shell</strong>== 是Spark提供的一个基于Scala语言的交互式解释器,类似于Scala提供的交互式解释器,Sparkshell也可以直接在Shell中编写代码执行这种方式也比较重要,因为一般的数据分析任务可能需要探索着进行,不是一蹴而就的,使用Sparkshell先进行探索,当代码稳定以后,使用独立应用的方式来提交任务,这样是一个比较常见的流程.</li> <li>==<strong>Spark submit</strong>== 是一个独立应用的命令,用于提交Scala编写的基于Spark框架,这种提交方式常用作于在集群中运行任务.</li></ul></li></ul> <h3 id="spark-shell的方式编写wordcount"><a href="#spark-shell的方式编写wordcount" class="header-anchor">#</a> Spark shell的方式编写WordCount</h3> <h4 id="spark-shell-简介"><a href="#spark-shell-简介" class="header-anchor">#</a> Spark shell 简介</h4> <ul><li><h5 id="启动-spark-shell"><a href="#启动-spark-shell" class="header-anchor">#</a> 启动 Spark shell</h5> <ul><li>进入 Spark 安装目录后执行 ==spark-shell --master==  就可以提交Spark 任务</li></ul></li> <li><p>Spark shell 的原理是把每一行 Scala 代码编译成类, 最终交由 Spark 执行</p></li> <li><h5 id="master地址的设置"><a href="#master地址的设置" class="header-anchor">#</a> Master地址的设置</h5></li></ul> <table><thead><tr><th style="text-align:left;">地址</th> <th style="text-align:left;">解释</th></tr></thead> <tbody><tr><td style="text-align:left;">local[N]</td> <td style="text-align:left;">使用N条Worker线程在本地运行</td></tr> <tr><td style="text-align:left;">spark://host:port</td> <td style="text-align:left;">在Spark standalone中运行,指定Spark集群的Master地址,端口默认为7077</td></tr> <tr><td style="text-align:left;">mesos://host:port</td> <td style="text-align:left;">在Apache Mesos中运行,指定Mesos的地址</td></tr> <tr><td style="text-align:left;">yarn</td> <td style="text-align:left;">在Yarn中运行,Yarn的地址由环境变量HADOOP_CONF_DIR来指定</td></tr></tbody></table> <h4 id="_1-实现wordcount的步骤"><a href="#_1-实现wordcount的步骤" class="header-anchor">#</a> 1. 实现WordCount的步骤</h4> <ul><li><h5 id="step-1-准备文件"><a href="#step-1-准备文件" class="header-anchor">#</a> <strong>Step 1</strong> :  准备文件</h5></li></ul> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment">#在node-1中创建文件</span>
<span class="token comment">#vim wordcount.txt</span>

hadoop spark flume
spark hadoop
flume hadoop
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li><h5 id="step-2-启动-spark-shell"><a href="#step-2-启动-spark-shell" class="header-anchor">#</a> <strong>Step 2</strong> :  启动 Spark shell</h5></li></ul> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment">#cd /export/servers/spark</span>
bin/spark-shell <span class="token parameter variable">--master</span> local<span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li><h5 id="step-3-执行步骤"><a href="#step-3-执行步骤" class="header-anchor">#</a> <strong>Step 3</strong> :  执行步骤</h5></li></ul> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token comment">//1.读取文件</span>
scala<span class="token operator">&gt;</span> <span class="token keyword">val</span> sourceRdd <span class="token operator">=</span> sc<span class="token punctuation">.</span>textFile<span class="token punctuation">(</span><span class="token string">&quot;file:///root/wordcount.txt&quot;</span><span class="token punctuation">)</span>
sourceRdd<span class="token operator">:</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>rdd<span class="token punctuation">.</span>RDD<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span> <span class="token operator">=</span> file<span class="token operator">:</span><span class="token operator">/</span><span class="token comment">//export/data/wordcount.txt MapPartitionsRDD[1] at textFile at &lt;console&gt;:24</span>

<span class="token comment">//2.拆分单词</span>
scala<span class="token operator">&gt;</span> <span class="token keyword">val</span> flattenCountRdd <span class="token operator">=</span> sourceRdd<span class="token punctuation">.</span>flatMap<span class="token punctuation">(</span>_<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>map<span class="token punctuation">(</span><span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
flattenCountRdd<span class="token operator">:</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>rdd<span class="token punctuation">.</span>RDD<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> MapPartitionsRDD<span class="token punctuation">[</span><span class="token number">3</span><span class="token punctuation">]</span> at map at <span class="token generics"><span class="token punctuation">&lt;</span>console<span class="token punctuation">&gt;</span></span><span class="token operator">:</span><span class="token number">26</span>

<span class="token comment">//3.标识每个单词的词频</span>
scala<span class="token operator">&gt;</span> <span class="token keyword">val</span> aggCountRdd <span class="token operator">=</span> flattenCountRdd<span class="token punctuation">.</span>reduceByKey<span class="token punctuation">(</span>_ <span class="token operator">+</span> _<span class="token punctuation">)</span>
aggCountRdd<span class="token operator">:</span> org<span class="token punctuation">.</span>apache<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>rdd<span class="token punctuation">.</span>RDD<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> ShuffledRDD<span class="token punctuation">[</span><span class="token number">4</span><span class="token punctuation">]</span> at reduceByKey at <span class="token generics"><span class="token punctuation">&lt;</span>console<span class="token punctuation">&gt;</span></span><span class="token operator">:</span><span class="token number">28</span>

<span class="token comment">//4.聚合计算词频</span>
scala<span class="token operator">&gt;</span> <span class="token keyword">val</span> result <span class="token operator">=</span> aggCountRdd<span class="token punctuation">.</span>collect
result<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> Array<span class="token punctuation">(</span><span class="token punctuation">(</span>spark<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>hadoop<span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span>flume<span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br></div></div><h4 id="_2-运行流程分析"><a href="#_2-运行流程分析" class="header-anchor">#</a> 2. 运行流程分析</h4> <ul><li><h5 id="上述代码中-sc-变量指的是sparkcontext-是spark程序的上下文和入口"><a href="#上述代码中-sc-变量指的是sparkcontext-是spark程序的上下文和入口" class="header-anchor">#</a> 上述代码中 ==sc 变量指的是SparkContext, 是Spark程序的上下文和入口.==</h5> <ul><li>正常情况下我们需要自己创建, 但是如果使用Spark shell的话, Spark shell会帮助我们创建, 并且以<strong>变量sc的形式提供给我们调用.</strong></li></ul></li> <li><h5 id="业务处理步骤"><a href="#业务处理步骤" class="header-anchor">#</a> 业务处理步骤</h5></li></ul> <ol><li><code>flatMap(_.split(&quot; &quot;))</code> 将数据转为数组的形式, 并展平为多个数据</li> <li><code>map_, 1</code> 将数据转换为元组的形式</li> <li><code>reduceByKey(_ + _)</code> 计算每个 Key 出现的次数</li></ol> <h3 id="读取-hdfs-上的文件"><a href="#读取-hdfs-上的文件" class="header-anchor">#</a> 读取 HDFS 上的文件</h3> <blockquote><p>Spark访问HDFS的两种方式</p></blockquote> <ul><li><h4 id="step-1-上传文件到-hdfs-中"><a href="#step-1-上传文件到-hdfs-中" class="header-anchor">#</a> Step 1 :  上传文件到 HDFS 中</h4> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment">#cd /export/data</span>
hdfs dfs <span class="token parameter variable">-mkdir</span> /dataset
hdfs dfs <span class="token parameter variable">-put</span> wordcount.txt /dataset/
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div></li> <li><h4 id="step-2-在spark-shell中访问hdfs"><a href="#step-2-在spark-shell中访问hdfs" class="header-anchor">#</a> Step 2 :  在Spark shell中访问HDFS</h4> <ul><li><h5 id="方式1-指定详细的node地址"><a href="#方式1-指定详细的node地址" class="header-anchor">#</a> 方式1	 ----   ==<strong>指定详细的node地址</strong>==</h5> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token keyword">val</span> sourceRdd <span class="token operator">=</span> sc<span class="token punctuation">.</span>textFile<span class="token punctuation">(</span><span class="token string">&quot;hdfs://node-1:8020/dataset/wordcount.txt&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">val</span> flattenCountRdd <span class="token operator">=</span> sourceRdd<span class="token punctuation">.</span>flatMap<span class="token punctuation">(</span>_<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>map<span class="token punctuation">(</span><span class="token punctuation">(</span>_<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">val</span> aggCountRdd <span class="token operator">=</span> flattenCountRdd<span class="token punctuation">.</span>reduceByKey<span class="token punctuation">(</span>_ <span class="token operator">+</span> _<span class="token punctuation">)</span>
<span class="token keyword">val</span> result <span class="token operator">=</span> aggCountRdd<span class="token punctuation">.</span>collect
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div></li> <li><h5 id="方式2-通过向spark配置hadoop的路径-可-直接写路径"><a href="#方式2-通过向spark配置hadoop的路径-可-直接写路径" class="header-anchor">#</a> 方式2	 ----   <strong>通过向Spark配置Hadoop的路径, 可==直接写路径==</strong></h5> <ul><li>在 <strong>spark-env.sh</strong> 中添加Hadoop的配置路径
<ul><li>==<strong>export HADOOP_CONF_DIR=&quot;/etc/hadoop/conf&quot;</strong>==</li></ul></li></ul> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token comment">//直接写路径</span>
<span class="token keyword">val</span> sourceRdd <span class="token operator">=</span> sc<span class="token punctuation">.</span>textFile<span class="token punctuation">(</span><span class="token string">&quot;/dataset/wordcount.txt&quot;</span><span class="token punctuation">)</span>

<span class="token comment">//可指定HDFS</span>
<span class="token keyword">val</span> sourceRdd <span class="token operator">=</span> sc<span class="token punctuation">.</span>textFile<span class="token punctuation">(</span><span class="token string">&quot;hdfs:///dataset/wordcount.txt&quot;</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div></li></ul></li></ul> <h3 id="编写独立应用提交spark任务"><a href="#编写独立应用提交spark任务" class="header-anchor">#</a> 编写独立应用提交Spark任务</h3> <h4 id="spark-submit-简介"><a href="#spark-submit-简介" class="header-anchor">#</a> spark-submit 简介</h4> <ul><li><h5 id="语法"><a href="#语法" class="header-anchor">#</a> 语法</h5> <ul><li>**app jar **----程序Jar包</li> <li><strong>app options -</strong>---程序Main方法传入的参数</li> <li>**options **----提交应用的参数,可以有如下选项</li></ul></li></ul> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code>spark-submit <span class="token punctuation">[</span>options<span class="token punctuation">]</span> <span class="token operator">&lt;</span>app jar<span class="token operator">&gt;</span> <span class="token operator">&lt;</span>app options<span class="token operator">&gt;</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li><h5 id="配置spark-submit命令的环境变量"><a href="#配置spark-submit命令的环境变量" class="header-anchor">#</a> 配置spark-submit命令的环境变量</h5> <div class="language-shell line-numbers-mode"><pre class="language-shell"><code><span class="token comment">#vim /etc/profile</span>

<span class="token builtin class-name">export</span> <span class="token assign-left variable">SPARK_BIN</span><span class="token operator">=</span>/export/servers/spark/bin
<span class="token builtin class-name">export</span> <span class="token assign-left variable"><span class="token environment constant">PATH</span></span><span class="token operator">=</span><span class="token environment constant">$PATH</span><span class="token builtin class-name">:</span><span class="token variable">$SPARK_BIN</span>

<span class="token comment">#source /etc/profile</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div></li> <li><h5 id="可选参数"><a href="#可选参数" class="header-anchor">#</a> 可选参数</h5></li></ul> <table><thead><tr><th>参数</th> <th>解释</th></tr></thead> <tbody><tr><td>--master</td> <td>同Spark shell的Master,可以是spark, yarn, mesos, kubernetes等URL</td></tr> <tr><td>--deploy-mode</td> <td>Driver运行位置,可选Client和Cluster,分别对应运行在本地和集群(Worker)中</td></tr> <tr><td>--class</td> <td>Jar中的Class,程序入口</td></tr> <tr><td>--jars</td> <td>依赖Jar包的位置</td></tr> <tr><td>--driver-memory</td> <td>Driver程序运行所需要的内存,默认512M</td></tr> <tr><td>--executor-memory</td> <td>Executor的内存大小,默认1G</td></tr></tbody></table> <h4 id="spark代码编写步骤"><a href="#spark代码编写步骤" class="header-anchor">#</a> Spark代码编写步骤</h4> <ol><li><p><strong>创建SparkConf</strong></p></li> <li><p><strong>创建SparkContext</strong></p></li> <li><p><strong>创建RDD</strong></p></li> <li><p><strong>对RDD使用Transformations类算子进行数据转换</strong></p></li> <li><p><strong>使用Action触发Transformations执行</strong></p></li> <li><p><strong>关闭SparkContext</strong></p></li></ol> <h4 id="_1-创建idea工程"><a href="#_1-创建idea工程" class="header-anchor">#</a> 1. 创建IDEA工程</h4> <div class="language-xml line-numbers-mode"><pre class="language-xml"><code> <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>properties</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scala.version</span><span class="token punctuation">&gt;</span></span>2.11.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scala.version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>spark.version</span><span class="token punctuation">&gt;</span></span>2.2.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>spark.version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>slf4j.version</span><span class="token punctuation">&gt;</span></span>1.7.16<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>slf4j.version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>log4j.version</span><span class="token punctuation">&gt;</span></span>1.2.17<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>log4j.version</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>properties</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependencies</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.scala-lang<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>scala-library<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${scala.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.spark<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>spark-core_2.11<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${spark.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.hadoop<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>hadoop-client<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>2.6.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.slf4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>jcl-over-slf4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${slf4j.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.slf4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>slf4j-api<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${slf4j.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.slf4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>slf4j-log4j12<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${slf4j.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>log4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>log4j<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>${log4j.version}<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>dependency</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>junit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>junit<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>4.10<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>scope</span><span class="token punctuation">&gt;</span></span>provided<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>scope</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependency</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>dependencies</span><span class="token punctuation">&gt;</span></span>

    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>build</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>sourceDirectory</span><span class="token punctuation">&gt;</span></span>src/main/scala<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>sourceDirectory</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>testSourceDirectory</span><span class="token punctuation">&gt;</span></span>src/test/scala<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>testSourceDirectory</span><span class="token punctuation">&gt;</span></span>

        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugins</span><span class="token punctuation">&gt;</span></span>

            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.maven.plugins<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>maven-compiler-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>source</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>source</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>target</span><span class="token punctuation">&gt;</span></span>1.8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>target</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>encoding</span><span class="token punctuation">&gt;</span></span>UTF-8<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>encoding</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>

            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>net.alchim31.maven<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>scala-maven-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.2.0<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>executions</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>execution</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goals</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goal</span><span class="token punctuation">&gt;</span></span>compile<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goal</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goal</span><span class="token punctuation">&gt;</span></span>testCompile<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goal</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goals</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>args</span><span class="token punctuation">&gt;</span></span>
                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>arg</span><span class="token punctuation">&gt;</span></span>-dependencyfile<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>arg</span><span class="token punctuation">&gt;</span></span>
                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>arg</span><span class="token punctuation">&gt;</span></span>${project.build.directory}/.scala_dependencies<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>arg</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>args</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>execution</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>executions</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>

            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>plugin</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>groupId</span><span class="token punctuation">&gt;</span></span>org.apache.maven.plugins<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>groupId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifactId</span><span class="token punctuation">&gt;</span></span>maven-shade-plugin<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifactId</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>version</span><span class="token punctuation">&gt;</span></span>3.1.1<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>version</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>executions</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>execution</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>phase</span><span class="token punctuation">&gt;</span></span>package<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>phase</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goals</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>goal</span><span class="token punctuation">&gt;</span></span>shade<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goal</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>goals</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>configuration</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filters</span><span class="token punctuation">&gt;</span></span>
                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>filter</span><span class="token punctuation">&gt;</span></span>
                                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>artifact</span><span class="token punctuation">&gt;</span></span>*:*<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>artifact</span><span class="token punctuation">&gt;</span></span>
                                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>excludes</span><span class="token punctuation">&gt;</span></span>
                                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclude</span><span class="token punctuation">&gt;</span></span>META-INF/*.SF<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclude</span><span class="token punctuation">&gt;</span></span>
                                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclude</span><span class="token punctuation">&gt;</span></span>META-INF/*.DSA<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclude</span><span class="token punctuation">&gt;</span></span>
                                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>exclude</span><span class="token punctuation">&gt;</span></span>META-INF/*.RSA<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>exclude</span><span class="token punctuation">&gt;</span></span>
                                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>excludes</span><span class="token punctuation">&gt;</span></span>
                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filter</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>filters</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transformers</span><span class="token punctuation">&gt;</span></span>
                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>transformer</span> <span class="token attr-name">implementation</span><span class="token attr-value"><span class="token punctuation attr-equals">=</span><span class="token punctuation">&quot;</span>org.apache.maven.plugins.shade.resource.ManifestResourceTransformer<span class="token punctuation">&quot;</span></span><span class="token punctuation">&gt;</span></span>
                                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;</span>mainClass</span><span class="token punctuation">&gt;</span></span><span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>mainClass</span><span class="token punctuation">&gt;</span></span>
                                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>transformer</span><span class="token punctuation">&gt;</span></span>
                            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>transformers</span><span class="token punctuation">&gt;</span></span>
                        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>configuration</span><span class="token punctuation">&gt;</span></span>
                    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>execution</span><span class="token punctuation">&gt;</span></span>
                <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>executions</span><span class="token punctuation">&gt;</span></span>
            <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugin</span><span class="token punctuation">&gt;</span></span>
        <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>plugins</span><span class="token punctuation">&gt;</span></span>
    <span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>build</span><span class="token punctuation">&gt;</span></span>
<span class="token tag"><span class="token tag"><span class="token punctuation">&lt;/</span>project</span><span class="token punctuation">&gt;</span></span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br><span class="line-number">78</span><br><span class="line-number">79</span><br><span class="line-number">80</span><br><span class="line-number">81</span><br><span class="line-number">82</span><br><span class="line-number">83</span><br><span class="line-number">84</span><br><span class="line-number">85</span><br><span class="line-number">86</span><br><span class="line-number">87</span><br><span class="line-number">88</span><br><span class="line-number">89</span><br><span class="line-number">90</span><br><span class="line-number">91</span><br><span class="line-number">92</span><br><span class="line-number">93</span><br><span class="line-number">94</span><br><span class="line-number">95</span><br><span class="line-number">96</span><br><span class="line-number">97</span><br><span class="line-number">98</span><br><span class="line-number">99</span><br><span class="line-number">100</span><br><span class="line-number">101</span><br><span class="line-number">102</span><br><span class="line-number">103</span><br><span class="line-number">104</span><br><span class="line-number">105</span><br><span class="line-number">106</span><br><span class="line-number">107</span><br><span class="line-number">108</span><br><span class="line-number">109</span><br><span class="line-number">110</span><br><span class="line-number">111</span><br><span class="line-number">112</span><br><span class="line-number">113</span><br><span class="line-number">114</span><br><span class="line-number">115</span><br><span class="line-number">116</span><br><span class="line-number">117</span><br><span class="line-number">118</span><br><span class="line-number">119</span><br><span class="line-number">120</span><br><span class="line-number">121</span><br><span class="line-number">122</span><br><span class="line-number">123</span><br></div></div><h4 id="_2-编写代码"><a href="#_2-编写代码" class="header-anchor">#</a> 2. 编写代码</h4> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token keyword">object</span> WordCounts <span class="token punctuation">{</span>

  <span class="token keyword">def</span> main<span class="token punctuation">(</span>args<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
      
    <span class="token comment">// 1. 创建 SparkConf</span>
    <span class="token keyword">val</span> conf <span class="token operator">=</span> <span class="token keyword">new</span> SparkConf<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setMaster<span class="token punctuation">(</span><span class="token string">&quot;local[2]&quot;</span><span class="token punctuation">)</span>
    <span class="token comment">// 2. 创建 Spark Context</span>
    <span class="token keyword">val</span> sc<span class="token operator">:</span> SparkContext <span class="token operator">=</span> <span class="token keyword">new</span> SparkContext<span class="token punctuation">(</span>conf<span class="token punctuation">)</span>

    <span class="token comment">// 3. 读取文件并计算词频</span>
          <span class="token comment">//1.读取文件</span>
        <span class="token keyword">val</span> source<span class="token operator">:</span> RDD<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span> <span class="token operator">=</span> sc<span class="token punctuation">.</span>textFile<span class="token punctuation">(</span><span class="token string">&quot;hdfs://node01:8020/dataset/wordcount.txt&quot;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
          <span class="token comment">//2.把整句话拆分为多个单词  </span>
        <span class="token keyword">val</span> words<span class="token operator">:</span> RDD<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span> <span class="token operator">=</span> source<span class="token punctuation">.</span>flatMap <span class="token punctuation">{</span> line <span class="token keyword">=&gt;</span> line<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
          <span class="token comment">//3.把每个单词指定一个词频</span>
        <span class="token keyword">val</span> wordsTuple<span class="token operator">:</span> RDD<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> words<span class="token punctuation">.</span>map <span class="token punctuation">{</span> word <span class="token keyword">=&gt;</span> <span class="token punctuation">(</span>word<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">}</span>
          <span class="token comment">//4.聚合</span>
        <span class="token keyword">val</span> wordsCount<span class="token operator">:</span> RDD<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> wordsTuple<span class="token punctuation">.</span>reduceByKey <span class="token punctuation">{</span> <span class="token punctuation">(</span>x<span class="token punctuation">,</span> y<span class="token punctuation">)</span> <span class="token keyword">=&gt;</span> x <span class="token operator">+</span> y <span class="token punctuation">}</span>
    <span class="token comment">// 4. 查看执行结果</span>
    wordsCount<span class="token punctuation">.</span>foreach<span class="token punctuation">(</span>println<span class="token punctuation">(</span>_<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><h4 id="_3-运行"><a href="#_3-运行" class="header-anchor">#</a> 3. 运行</h4> <ol><li><h5 id="直接在idea中运行spark程序"><a href="#直接在idea中运行spark程序" class="header-anchor">#</a> <strong>直接在IDEA中运行Spark程序</strong></h5></li> <li><h5 id="打包提交集群中-使用spark-submit命令运行"><a href="#打包提交集群中-使用spark-submit命令运行" class="header-anchor">#</a> 打包提交集群中==使用spark-submit命令运行==</h5> <ul><li><h5 id="在-node-1中jar包所在的目录执行如下命令"><a href="#在-node-1中jar包所在的目录执行如下命令" class="header-anchor">#</a> 在 node-1中Jar包所在的目录执行如下命令</h5></li></ul></li></ol> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code>spark<span class="token operator">-</span>submit <span class="token operator">--</span>master spark<span class="token operator">:</span><span class="token operator">/</span><span class="token operator">/</span>node<span class="token operator">-</span><span class="token number">1</span><span class="token operator">:</span><span class="token number">7077</span> \
<span class="token operator">--</span><span class="token keyword">class</span> com<span class="token punctuation">.</span>spark<span class="token punctuation">.</span>demo_1<span class="token punctuation">.</span>WordCounts \
sprak_demo1<span class="token operator">-</span><span class="token number">1.0</span><span class="token operator">-</span>SNAPSHOT<span class="token punctuation">.</span>jar
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="rdd概念"><a href="#rdd概念" class="header-anchor">#</a> RDD概念</h2> <h3 id="_1-rdd是什么"><a href="#_1-rdd是什么" class="header-anchor">#</a> 1. RDD是什么</h3> <ul><li><strong>概念 :</strong>  ==RDD, 全称为Resilient Distributed Datasets, 是一个不可变、可分区、里面的元素可以并行计算的弹性分布式数据集。==</li></ul> <ol><li><h5 id="rdd是数据集"><a href="#rdd是数据集" class="header-anchor">#</a> RDD是数据集</h5></li> <li><h5 id="rdd是编程模型"><a href="#rdd是编程模型" class="header-anchor">#</a> RDD是编程模型</h5></li> <li><h5 id="rdd相互之间有依赖关系"><a href="#rdd相互之间有依赖关系" class="header-anchor">#</a> RDD相互之间有依赖关系</h5></li> <li><h5 id="rdd是可以分区的"><a href="#rdd是可以分区的" class="header-anchor">#</a> RDD是可以分区的</h5> <ul><li>RDD 之所以要设计为有分区的, 是<strong>因为要进行分布式计算, 每个不同的分区可以在不同的线程, 或者进程, 甚至节点中, 从而做到并行计算.</strong></li></ul></li></ol> <blockquote><p>例如上图中, 使用了一个 RDD 表示 HDFS 上的某一个文件, 这个文件在 HDFS 中是分三块, 那么 RDD 在读取的时候就也有三个分区, 每个 RDD 的分区对应了一个 HDFS 的分块 . 后续 RDD 在计算的时候, 可以更改分区, 也可以保持三个分区, 每个分区之间有依赖关系, 例如说 RDD2 的分区一依赖了 RDD1 的分区.</p></blockquote> <h3 id="_2-创建rdd"><a href="#_2-创建rdd" class="header-anchor">#</a> 2. 创建RDD</h3> <h4 id="sparkcontext"><a href="#sparkcontext" class="header-anchor">#</a> SparkContext</h4> <ul><li><h5 id="sparkcontext是spark-core的入口组件-是一个spark程序的入口"><a href="#sparkcontext是spark-core的入口组件-是一个spark程序的入口" class="header-anchor">#</a> <strong>SparkContext</strong>是spark-core的入口组件,是一个Spark程序的入口,</h5></li> <li><p>在Driver中SparkContext是最主要的组件,也是Driver在运行时首先会创建的组件,是Driver的核心.</p></li> <li><h5 id="sparkcontext主要作用"><a href="#sparkcontext主要作用" class="header-anchor">#</a> SparkContext主要作用</h5> <ul><li>创建 RDD, 主要是通过读取文件创建 RDD</li> <li>监控和调度任务, 包含了一系列组件, 例如 DAGScheduler, TaskSheduler,累加器,广播变量</li></ul></li></ul> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token comment">//1.创建 SparkConf</span>
<span class="token keyword">val</span> conf <span class="token operator">=</span> <span class="token keyword">new</span> SparkConf<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setAppName<span class="token punctuation">(</span><span class="token string">&quot;spark_context&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setMaster<span class="token punctuation">(</span><span class="token string">&quot;local[6]&quot;</span><span class="token punctuation">)</span>
<span class="token comment">//2.创建 SparkContext</span>
<span class="token keyword">val</span> sc <span class="token operator">=</span> <span class="token keyword">new</span> SparkContext<span class="token punctuation">(</span>conf<span class="token punctuation">)</span>
<span class="token comment">//3.关闭 SparkContext, 释放集群资源</span>
sc<span class="token punctuation">.</span>stop<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="rdd三种创建方式"><a href="#rdd三种创建方式" class="header-anchor">#</a> RDD三种创建方式</h4> <ul><li><h5 id="rdd可以通过本地集合直接创建"><a href="#rdd可以通过本地集合直接创建" class="header-anchor">#</a> RDD可以通过本地集合直接创建</h5> <ul><li>通过 ==<strong>parallelize</strong>== 和 ==<strong>makeRDD</strong>== 这两个API创建RDD, 第一个参数是<strong>本地集合</strong>, 第二个参数是<strong>分区数</strong></li></ul></li></ul> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code>  <span class="token keyword">def</span> rddCreationLocal<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token keyword">val</span> conf <span class="token operator">=</span> <span class="token keyword">new</span> SparkConf<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setMaster<span class="token punctuation">(</span><span class="token string">&quot;local[6]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setAppName<span class="token punctuation">(</span><span class="token string">&quot;spark_context&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">val</span> sc <span class="token operator">=</span> <span class="token keyword">new</span> SparkContext<span class="token punctuation">(</span>conf<span class="token punctuation">)</span>
      
    <span class="token comment">//定义Seq集合,可与list互转</span>
    <span class="token keyword">val</span> seq<span class="token operator">:</span> Seq<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span> <span class="token operator">=</span> Seq<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
      
    <span class="token comment">//parallelize方式</span>
    <span class="token keyword">val</span> rdd1<span class="token operator">:</span> RDD<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span> <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span>seq<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
    sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span>seq<span class="token punctuation">)</span>
      
    <span class="token comment">//makeRDD方式</span>
    <span class="token keyword">val</span> rdd2<span class="token operator">:</span> RDD<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span> <span class="token operator">=</span> sc<span class="token punctuation">.</span>makeRDD<span class="token punctuation">(</span>seq<span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><ul><li><h5 id="rdd也可以通过读取外部数据集来创建-常用"><a href="#rdd也可以通过读取外部数据集来创建-常用" class="header-anchor">#</a> RDD也可以通过读取外部数据集来创建   ----  ==常用==</h5> <ul><li><h5 id="访问方式"><a href="#访问方式" class="header-anchor">#</a> 访问方式</h5> <ol><li>访问<strong>本地文件</strong>,  sc.textFile(&quot;==file:///  …==&quot;)</li> <li>支持访问文件夹, 例如  sc.textFile(&quot;==hdfs://node-1:8020/dataset==&quot;)</li> <li>支持访问压缩文件, 例如  sc.textFile(&quot;==hdfs://node-1:8020/dataset/words.gz==&quot;)</li> <li>支持通过通配符访问, 例如  sc.textFile(&quot;==hdfs:///dataset/*.txt==&quot;)</li></ol></li></ul></li></ul> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code>  <span class="token keyword">def</span> rddCreationFiles<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token keyword">val</span> conf <span class="token operator">=</span> <span class="token keyword">new</span> SparkConf<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setAppName<span class="token punctuation">(</span><span class="token string">&quot;spark_context&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setMaster<span class="token punctuation">(</span><span class="token string">&quot;local[6]&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">val</span> sc <span class="token operator">=</span> <span class="token keyword">new</span> SparkContext<span class="token punctuation">(</span>conf<span class="token punctuation">)</span>
      
	<span class="token comment">//访问本地文件</span>
    sc<span class="token punctuation">.</span>textFile<span class="token punctuation">(</span><span class="token string">&quot;file:///E:/RDDdemo/dataset/WordCount.txt&quot;</span><span class="token punctuation">)</span>
      
    <span class="token comment">//  访问hdfs文件</span>
    sc<span class="token punctuation">.</span>textFile<span class="token punctuation">(</span><span class="token string">&quot;hdfs://node-1:8020/...&quot;</span><span class="token punctuation">)</span>      
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><ul><li><h5 id="rdd也可以通过其它的rdd衍生而来"><a href="#rdd也可以通过其它的rdd衍生而来" class="header-anchor">#</a> RDD也可以通过其它的RDD衍生而来</h5></li></ul> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code>  <span class="token keyword">def</span> rddCreateFromRDD<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token keyword">val</span> conf <span class="token operator">=</span> <span class="token keyword">new</span> SparkConf<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setMaster<span class="token punctuation">(</span><span class="token string">&quot;local[6]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setAppName<span class="token punctuation">(</span><span class="token string">&quot;spark_context&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">val</span> sc <span class="token operator">=</span> <span class="token keyword">new</span> SparkContext<span class="token punctuation">(</span>conf<span class="token punctuation">)</span>

    <span class="token comment">//通过本地集合直接创建rdd</span>
    <span class="token keyword">val</span> rdd1 <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span>Seq<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      
    <span class="token comment">// 通过在rdd上执行算子操作, 会生成新的rdd</span>
    <span class="token keyword">val</span> rdd2<span class="token operator">:</span> RDD<span class="token punctuation">[</span><span class="token builtin">Int</span><span class="token punctuation">]</span> <span class="token operator">=</span> rdd1<span class="token punctuation">.</span>map<span class="token punctuation">(</span>item <span class="token keyword">=&gt;</span> item<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br></div></div><h3 id="_3-rdd算子"><a href="#_3-rdd算子" class="header-anchor">#</a> 3. RDD算子</h3> <h4 id="map-算子"><a href="#map-算子" class="header-anchor">#</a> Map 算子</h4> <blockquote><p>把 RDD 中的数据 一对一 的转为另一种形式</p></blockquote> <ul><li><h5 id="语法-2"><a href="#语法-2" class="header-anchor">#</a> 语法</h5> <ul><li>是<code>原RDD</code> → <code>新RDD</code> 的过程, 这个函数的参数是原RDD数据, 返回值是经过函数转换的新RDD的数据</li></ul></li></ul> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token keyword">def</span> map<span class="token punctuation">[</span>U<span class="token operator">:</span> ClassTag<span class="token punctuation">]</span><span class="token punctuation">(</span>f<span class="token operator">:</span> T ⇒ U<span class="token punctuation">)</span><span class="token operator">:</span> RDD<span class="token punctuation">[</span>U<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="Spark.assets/c59d44296918b864a975ebbeb60d4c04.png" alt="c59d44296918b864a975ebbeb60d4c04"></p> <ul><li><h5 id="示例"><a href="#示例" class="header-anchor">#</a> 示例</h5></li></ul> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code>sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span>Seq<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span>map<span class="token punctuation">(</span> num <span class="token keyword">=&gt;</span> num <span class="token operator">*</span> <span class="token number">10</span> <span class="token punctuation">)</span>
  <span class="token punctuation">.</span>collect<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="flatmap算子"><a href="#flatmap算子" class="header-anchor">#</a> FlatMap算子</h4> <blockquote><p>flatMap 其实是两个操作, 是 <strong>map + flatten,</strong> 也就是先转换, 后把转换而来的 List 展开</p></blockquote> <ul><li><h5 id="语法-3"><a href="#语法-3" class="header-anchor">#</a> 语法</h5> <ul><li>参数是原RDD数据, 返回值是经过函数转换的新RDD的数据</li></ul></li></ul> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token keyword">def</span> flatMap<span class="token punctuation">[</span>U<span class="token operator">:</span> ClassTag<span class="token punctuation">]</span><span class="token punctuation">(</span>f<span class="token operator">:</span> T ⇒ List<span class="token punctuation">[</span>U<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> RDD<span class="token punctuation">[</span>U<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="Spark.assets/f6c4feba14bb71372aa0cb678067c6a8.png" alt="f6c4feba14bb71372aa0cb678067c6a8"></p> <ul><li><h5 id="示例-2"><a href="#示例-2" class="header-anchor">#</a> 示例</h5></li></ul> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code>sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span>Seq<span class="token punctuation">(</span><span class="token string">&quot;Hello lily&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Hello lucy&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Hello tim&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span>flatMap<span class="token punctuation">(</span> line <span class="token keyword">=&gt;</span> line<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
  <span class="token punctuation">.</span>collect<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="reducebykey算子"><a href="#reducebykey算子" class="header-anchor">#</a> ReduceByKey算子</h4> <blockquote><p>首先按照 Key 分组, 接下来把整组的Value计算出一个聚合值, 这个操作非常类似于MapReduce 中的Reduce</p></blockquote> <ul><li><h5 id="语法-4"><a href="#语法-4" class="header-anchor">#</a> 语法</h5> <ul><li>func → 执行数据处理的函数, 传入两个参数, 一个是当前值, 一个是局部汇总 ; 这个函数需要有一个输出, 输出就是这个Key的汇总结果</li></ul></li></ul> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token keyword">def</span> reduceByKey<span class="token punctuation">(</span>func<span class="token operator">:</span> <span class="token punctuation">(</span>V<span class="token punctuation">,</span> V<span class="token punctuation">)</span> ⇒ V<span class="token punctuation">)</span><span class="token operator">:</span> RDD<span class="token punctuation">[</span><span class="token punctuation">(</span>K<span class="token punctuation">,</span> V<span class="token punctuation">)</span><span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><p><img src="Spark.assets/07678e1b4d6ba1dfaf2f5df89489def4.png" alt="07678e1b4d6ba1dfaf2f5df89489def4"></p> <ul><li><h5 id="示例-3"><a href="#示例-3" class="header-anchor">#</a> 示例</h5></li></ul> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code>sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span>Seq<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span>reduceByKey<span class="token punctuation">(</span> <span class="token punctuation">(</span>curr<span class="token punctuation">,</span> agg<span class="token punctuation">)</span> <span class="token keyword">=&gt;</span> curr <span class="token operator">+</span> agg <span class="token punctuation">)</span>
  <span class="token punctuation">.</span>collect<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h2 id="rdd算子"><a href="#rdd算子" class="header-anchor">#</a> RDD算子</h2> <h3 id="_1-rdd算子分类和特点"><a href="#_1-rdd算子分类和特点" class="header-anchor">#</a> 1. RDD算子分类和特点</h3> <ul><li><h5 id="rdd算子从功能上分为两大类"><a href="#rdd算子从功能上分为两大类" class="header-anchor">#</a> RDD算子从功能上分为两大类</h5> <ol><li>==<strong>Transformation</strong>(转换操作)== :   它会在一个已存在的RDD上创建一个新RDD,将旧RDD的数据转换为另外一种形式后放入新的RDD.</li> <li>==<strong>Action</strong>(动作操作)== :  执行各个分区的计算任务,将得到的结果返回到Driver中.</li></ol></li> <li><h5 id="rdd算子特点"><a href="#rdd算子特点" class="header-anchor">#</a> RDD算子特点</h5> <ul><li>Transformations是Lazy(惰性)的 , 在执行到转换操作的时候, 并不会立刻执行, 直到遇见了Action操作, 才会触发真正的执行, 这个特点叫做 <strong>惰性求值</strong>.</li> <li>默认情况下,每一个Action运行的时候,其所关联的所有Transformation RDD都会重新计算,但是也可以使用presist 方法将RDD持久化到磁盘或者内存中.这个时候为了下次可以更快的访问, 会把数据保存到集群上.</li></ul></li> <li><h5 id="rdd数据类型分类"><a href="#rdd数据类型分类" class="header-anchor">#</a> RDD数据类型分类</h5> <ul><li><strong>字符串 :</strong> 针对基础类型(例如 String)处理的普通算子</li> <li><strong>键值对 :</strong> 针对 (Key-Value ) 数据处理的byKey算子</li> <li><strong>数字型 :</strong> 针对数字类型数据处理的计算算子</li></ul></li></ul> <h3 id="_2-transformations-算子"><a href="#_2-transformations-算子" class="header-anchor">#</a> 2. Transformations 算子</h3> <h4 id="map-转换操作"><a href="#map-转换操作" class="header-anchor">#</a> Map--转换操作</h4> <blockquote><p>把RDD中的==<strong>每一条数据</strong>==中的每个元素一对一的转为另一种形式</p></blockquote> <ul><li><h5 id="语法-5"><a href="#语法-5" class="header-anchor">#</a> 语法</h5></li></ul> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token keyword">def</span> map<span class="token punctuation">[</span>U<span class="token operator">:</span> ClassTag<span class="token punctuation">]</span><span class="token punctuation">(</span>f<span class="token operator">:</span> T <span class="token keyword">=&gt;</span> U<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li><h5 id="示例-4"><a href="#示例-4" class="header-anchor">#</a> 示例</h5></li></ul> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code>sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span>Seq<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span>map<span class="token punctuation">(</span> num <span class="token keyword">=&gt;</span> num <span class="token operator">*</span> <span class="token number">10</span> <span class="token punctuation">)</span>
  <span class="token punctuation">.</span>collect<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="mapvalues-转换操作"><a href="#mapvalues-转换操作" class="header-anchor">#</a> MapValues--转换操作</h4> <blockquote><p>MapValues只能作用于Key-Value型数据, <strong>==mapValue作用于Value==</strong>.</p></blockquote> <ul><li><h5 id="语法-6"><a href="#语法-6" class="header-anchor">#</a> 语法</h5></li></ul> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token keyword">def</span> mapValues<span class="token punctuation">[</span>U<span class="token punctuation">]</span><span class="token punctuation">(</span>f<span class="token operator">:</span> V <span class="token keyword">=&gt;</span> U<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li><h5 id="示例-5"><a href="#示例-5" class="header-anchor">#</a> 示例</h5></li></ul> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code>sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span>Seq<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">&quot;c&quot;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span>mapValues<span class="token punctuation">(</span> item <span class="token keyword">=&gt;</span> item <span class="token operator">*</span> <span class="token number">10</span> <span class="token punctuation">)</span>
  <span class="token punctuation">.</span>collect<span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span>foreach<span class="token punctuation">(</span>println<span class="token punctuation">(</span>_<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="mappartitions-转换操作"><a href="#mappartitions-转换操作" class="header-anchor">#</a> MapPartitions--转换操作</h4> <blockquote><p>map是针对**==每一条数据中的每个元素==** 进行转换,</p> <p>mapPartitions针对==<strong>整个分区中的每一条数据</strong>== 进行转换</p></blockquote> <ul><li><h5 id="语法-7"><a href="#语法-7" class="header-anchor">#</a> 语法</h5> <ul><li>func参数是一个集合(一个分区整个所有的数据) , 返回值也是一个集合.</li></ul></li></ul> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token keyword">def</span> mapPartitions<span class="token punctuation">[</span>U<span class="token operator">:</span> ClassTag<span class="token punctuation">]</span><span class="token punctuation">(</span>
        f<span class="token operator">:</span> Iterator<span class="token punctuation">[</span>T<span class="token punctuation">]</span> <span class="token keyword">=&gt;</span> Iterator<span class="token punctuation">[</span>U<span class="token punctuation">]</span><span class="token punctuation">,</span>
        preservesPartitioning<span class="token operator">:</span> <span class="token builtin">Boolean</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li><h5 id="示例-6"><a href="#示例-6" class="header-anchor">#</a> 示例</h5></li></ul> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code>sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span>Seq<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span>mapPartitions<span class="token punctuation">(</span>iter <span class="token keyword">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// 遍历iter其中每一条数据进行转换, 转换完成以后, 返回这个iter</span>
    <span class="token comment">// iter是scala中的集合类型</span>
    iter<span class="token punctuation">.</span>map<span class="token punctuation">(</span>item <span class="token keyword">=&gt;</span> item <span class="token operator">*</span> <span class="token number">10</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span>collect<span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span>foreach<span class="token punctuation">(</span>item <span class="token keyword">=&gt;</span> println<span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">)</span>


<span class="token comment">/**
  * RDD[&quot;我&quot;,&quot;是&quot;,&quot;中&quot;,&quot;国&quot;,&quot;人&quot;,&quot;啊&quot;]
  * RDD[&quot;{我}&quot;,&quot;{是}&quot;,&quot;{中}&quot;,&quot;{国}&quot;,&quot;{人}&quot;,&quot;{啊}&quot;]
  */</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">def</span> mapPartitionFunction2<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span><span class="token punctuation">{</span>
  <span class="token keyword">val</span> rdd<span class="token operator">:</span> RDD<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span> <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span><span class="token string">&quot;我 是 中 国 人 啊&quot;</span><span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">)</span>
  rdd<span class="token punctuation">.</span>mapPartitions<span class="token punctuation">(</span>iter <span class="token keyword">=&gt;</span> <span class="token punctuation">{</span>
    <span class="token comment">// iter是scala中的集合类型</span>
    iter<span class="token punctuation">.</span>map<span class="token punctuation">(</span>x <span class="token keyword">=&gt;</span> x<span class="token punctuation">.</span>mkString<span class="token punctuation">(</span><span class="token string">&quot;{&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;,&quot;</span><span class="token punctuation">,</span><span class="token string">&quot;}&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>collect<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>foreach<span class="token punctuation">(</span>println<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br></div></div><ul><li><h4 id="实际开发用法-连接数据库"><a href="#实际开发用法-连接数据库" class="header-anchor">#</a> 实际开发用法  --  连接数据库</h4></li></ul> <blockquote><h5 id="连接数据库的操作必须放到算子内部才能正确的被executor执行-那mappartitions就显示比map要有优势"><a href="#连接数据库的操作必须放到算子内部才能正确的被executor执行-那mappartitions就显示比map要有优势" class="header-anchor">#</a> 连接数据库的操作必须放到算子内部才能正确的被Executor执行, 那mapPartitions就显示比map要有优势.</h5> <ul><li><h5 id="一个分区只要连接一次数据库"><a href="#一个分区只要连接一次数据库" class="header-anchor">#</a> 一个分区只要连接一次数据库</h5></li></ul></blockquote> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code>  rdd<span class="token punctuation">.</span>mapPartitions<span class="token punctuation">(</span>x <span class="token keyword">=&gt;</span> <span class="token punctuation">{</span>
      <span class="token keyword">new</span> Iterator<span class="token punctuation">[</span><span class="token builtin">Any</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>
        <span class="token keyword">override</span> <span class="token keyword">def</span> hasNext<span class="token operator">:</span> <span class="token builtin">Boolean</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
          <span class="token keyword">if</span> <span class="token punctuation">(</span>x<span class="token punctuation">.</span>hasNext<span class="token punctuation">)</span> <span class="token punctuation">{</span>
            <span class="token boolean">true</span>
          <span class="token punctuation">}</span> <span class="token keyword">else</span> <span class="token punctuation">{</span>
            println<span class="token punctuation">(</span><span class="token string">&quot;关闭数据库&quot;</span><span class="token punctuation">)</span>
            <span class="token boolean">false</span>
          <span class="token punctuation">}</span>
        <span class="token punctuation">}</span>
        
        <span class="token keyword">override</span> <span class="token keyword">def</span> next<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Any</span> <span class="token operator">=</span> <span class="token string">&quot;写入数据&quot;</span> <span class="token operator">+</span> x<span class="token punctuation">.</span>next<span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">}</span>
    <span class="token punctuation">}</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br></div></div><h4 id="mappartitionswithindex-转换操作"><a href="#mappartitionswithindex-转换操作" class="header-anchor">#</a> MapPartitionsWithIndex--转换操作</h4> <blockquote><p>和mapPartitions的区别是func中多了一个<strong>分区号的参数</strong>, ==<strong>用于获取每个分区的数据</strong>==.</p></blockquote> <ul><li><h5 id="语法-8"><a href="#语法-8" class="header-anchor">#</a> 语法</h5></li></ul> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token keyword">def</span> mapPartitionsWithIndex<span class="token punctuation">[</span>U<span class="token operator">:</span> ClassTag<span class="token punctuation">]</span><span class="token punctuation">(</span>
        f<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token builtin">Int</span><span class="token punctuation">,</span> Iterator<span class="token punctuation">[</span>T<span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">=&gt;</span> Iterator<span class="token punctuation">[</span>U<span class="token punctuation">]</span><span class="token punctuation">,</span>
        preservesPartitioning<span class="token operator">:</span> <span class="token builtin">Boolean</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><ul><li><h5 id="示例-7"><a href="#示例-7" class="header-anchor">#</a> 示例</h5></li></ul> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code>sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span>Seq<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span>mapPartitionsWithIndex<span class="token punctuation">(</span><span class="token punctuation">(</span>index<span class="token punctuation">,</span> iter<span class="token punctuation">)</span> <span class="token keyword">=&gt;</span> <span class="token punctuation">{</span>
    println<span class="token punctuation">(</span><span class="token string-interpolation"><span class="token id function">s</span><span class="token string">&quot;index : </span><span class="token interpolation"><span class="token punctuation">${</span><span class="token expression">index</span><span class="token punctuation">}</span></span><span class="token string">  ---  </span><span class="token interpolation"><span class="token punctuation">${</span><span class="token expression">iter<span class="token punctuation">.</span>mkString<span class="token punctuation">(</span><span class="token string">&quot;:&quot;</span><span class="token punctuation">)</span></span><span class="token punctuation">}</span></span><span class="token string">&quot;</span></span><span class="token punctuation">)</span>
    iter
  <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>collect<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="flatmap-转换操作"><a href="#flatmap-转换操作" class="header-anchor">#</a> FlatMap--转换操作</h4> <blockquote><p>返回的是经过函数转换成的新RDD集合</p></blockquote> <ul><li><h5 id="语法-9"><a href="#语法-9" class="header-anchor">#</a> 语法</h5></li></ul> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token keyword">def</span> flatMap<span class="token punctuation">[</span>U<span class="token operator">:</span> ClassTag<span class="token punctuation">]</span><span class="token punctuation">(</span>f<span class="token operator">:</span> T ⇒ List<span class="token punctuation">[</span>U<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> RDD<span class="token punctuation">[</span>U<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li><h5 id="示例-8"><a href="#示例-8" class="header-anchor">#</a> 示例</h5></li></ul> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code>sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span>Seq<span class="token punctuation">(</span><span class="token string">&quot;Hello lily&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Hello lucy&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Hello tim&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span>flatMap<span class="token punctuation">(</span> line <span class="token keyword">=&gt;</span> line<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
  <span class="token punctuation">.</span>collect<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="filter-过滤操作"><a href="#filter-过滤操作" class="header-anchor">#</a> Filter--过滤操作</h4> <blockquote><p>可以过滤掉数据集中一部分元素</p></blockquote> <ul><li><h5 id="语法-10"><a href="#语法-10" class="header-anchor">#</a> 语法</h5> <ul><li><strong>ture,</strong>    当前元素就会被加入新数据集</li> <li><strong>flase,</strong>   当前元素会被过滤掉</li></ul></li></ul> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token keyword">def</span> filter<span class="token punctuation">(</span>f<span class="token operator">:</span> T <span class="token keyword">=&gt;</span> <span class="token builtin">Boolean</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li><h5 id="示例-9"><a href="#示例-9" class="header-anchor">#</a> 示例</h5></li></ul> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code>sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span>Seq<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span>filter<span class="token punctuation">(</span>item <span class="token keyword">=&gt;</span> item <span class="token operator">%</span> <span class="token number">2</span> <span class="token operator">==</span> <span class="token number">0</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span>collect<span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span>foreach<span class="token punctuation">(</span>item <span class="token keyword">=&gt;</span> println<span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="sample-过滤操作"><a href="#sample-过滤操作" class="header-anchor">#</a> Sample--过滤操作</h4> <blockquote><p>从一个数据集中抽样出来一部分, 常用作于把大数据集变小, 尽可能的减少数据集规律的损失.</p></blockquote> <ul><li><h5 id="语法-11"><a href="#语法-11" class="header-anchor">#</a> 语法</h5> <ul><li><strong>withReplacement</strong>  :  意为是否取样以后是否还放回原数据集供下次使用</li> <li><strong>fraction</strong>  :  意为抽样的比例</li> <li><strong>seed</strong>   :  随机数种子, 用于Sample内部随机生成下标, 一般不指定, 使用默认值.</li></ul></li></ul> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token keyword">def</span> sample<span class="token punctuation">(</span>
      withReplacement<span class="token operator">:</span> <span class="token builtin">Boolean</span><span class="token punctuation">,</span>
      fraction<span class="token operator">:</span> <span class="token builtin">Double</span><span class="token punctuation">,</span>
      seed<span class="token operator">:</span> <span class="token builtin">Long</span> <span class="token operator">=</span> Utils<span class="token punctuation">.</span>random<span class="token punctuation">.</span>nextLong<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li><h5 id="示例-10"><a href="#示例-10" class="header-anchor">#</a> 示例</h5></li></ul> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code>sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span>Seq<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">,</span> <span class="token number">9</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span>sample<span class="token punctuation">(</span>withReplacement <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span> <span class="token number">0.6</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span>collect<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>foreach<span class="token punctuation">(</span>item <span class="token keyword">=&gt;</span> println<span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="union-集合操作"><a href="#union-集合操作" class="header-anchor">#</a> Union--集合操作</h4> <blockquote><p>并集</p></blockquote> <ul><li><h5 id="语法-12"><a href="#语法-12" class="header-anchor">#</a> 语法</h5></li></ul> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token keyword">def</span> union<span class="token punctuation">(</span>other<span class="token operator">:</span> RDD<span class="token punctuation">[</span>T<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li><h5 id="示例-11"><a href="#示例-11" class="header-anchor">#</a> 示例</h5></li></ul> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token keyword">val</span> rdd1 <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span>Seq<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">val</span> rdd2 <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span>Seq<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
rdd1<span class="token punctuation">.</span>union<span class="token punctuation">(</span>rdd2<span class="token punctuation">)</span>
  <span class="token punctuation">.</span>collect<span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span>foreach<span class="token punctuation">(</span>println<span class="token punctuation">(</span>_<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="intersection-集合操作"><a href="#intersection-集合操作" class="header-anchor">#</a> Intersection--集合操作</h4> <blockquote><p>交集</p></blockquote> <ul><li><h5 id="语法-13"><a href="#语法-13" class="header-anchor">#</a> 语法</h5></li></ul> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token keyword">def</span> intersection<span class="token punctuation">(</span>other<span class="token operator">:</span> RDD<span class="token punctuation">[</span>T<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li><h5 id="示例-12"><a href="#示例-12" class="header-anchor">#</a> 示例</h5></li></ul> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token keyword">val</span> rdd1 <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span>Seq<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">val</span> rdd2 <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span>Seq<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
rdd1<span class="token punctuation">.</span>intersection<span class="token punctuation">(</span>rdd2<span class="token punctuation">)</span>
  <span class="token punctuation">.</span>collect<span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span>foreach<span class="token punctuation">(</span>println<span class="token punctuation">(</span>_<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="subtract-集合操作"><a href="#subtract-集合操作" class="header-anchor">#</a> Subtract--集合操作</h4> <blockquote><p>差集</p></blockquote> <ul><li><h5 id="语法-14"><a href="#语法-14" class="header-anchor">#</a> 语法</h5></li></ul> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token keyword">def</span> subtract<span class="token punctuation">(</span>other<span class="token operator">:</span> RDD<span class="token punctuation">[</span>T<span class="token punctuation">]</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li><h5 id="示例-13"><a href="#示例-13" class="header-anchor">#</a> 示例</h5></li></ul> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token keyword">val</span> rdd1 <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span>Seq<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">val</span> rdd2 <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span>Seq<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">,</span> <span class="token number">7</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
rdd1<span class="token punctuation">.</span>subtract<span class="token punctuation">(</span>rdd2<span class="token punctuation">)</span>
  <span class="token punctuation">.</span>collect<span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span>foreach<span class="token punctuation">(</span>println<span class="token punctuation">(</span>_<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="distinct-集合操作"><a href="#distinct-集合操作" class="header-anchor">#</a> Distinct--集合操作</h4> <blockquote><p>Distinct 算子用于去重</p> <p>本质上 Distinct 就是一个reductByKey, 把重复的合并为一个</p></blockquote> <ul><li><h5 id="语法-15"><a href="#语法-15" class="header-anchor">#</a> 语法</h5></li></ul> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token keyword">def</span> distinct<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li><h5 id="示例-14"><a href="#示例-14" class="header-anchor">#</a> 示例</h5></li></ul> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code>sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span>Seq<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span>distinct<span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span>collect<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="join-集合操作"><a href="#join-集合操作" class="header-anchor">#</a> Join--集合操作</h4> <blockquote><p>将两个RDD按照==相同的Key进行内连接==, 结果是一个笛卡尔积形式.</p></blockquote> <ul><li><h5 id="语法-16"><a href="#语法-16" class="header-anchor">#</a> 语法</h5></li></ul> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token keyword">def</span> join<span class="token punctuation">[</span>W<span class="token punctuation">]</span><span class="token punctuation">(</span>other<span class="token operator">:</span> RDD<span class="token punctuation">[</span><span class="token punctuation">(</span>K<span class="token punctuation">,</span> W<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> RDD<span class="token punctuation">[</span><span class="token punctuation">(</span>K<span class="token punctuation">,</span> <span class="token punctuation">(</span>V<span class="token punctuation">,</span> W<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li><h5 id="示例-15"><a href="#示例-15" class="header-anchor">#</a> 示例</h5></li></ul> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token keyword">val</span> rdd1 <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span>Seq<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">val</span> rdd2 <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span>Seq<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token number">11</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token number">12</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
rdd1<span class="token punctuation">.</span>join<span class="token punctuation">(</span>rdd2<span class="token punctuation">)</span>
  <span class="token punctuation">.</span>collect<span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span>foreach<span class="token punctuation">(</span>println<span class="token punctuation">(</span>_<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="reducebykey-聚合操作"><a href="#reducebykey-聚合操作" class="header-anchor">#</a> ReduceByKey--聚合操作</h4> <blockquote><p>首先按照Key分组, 接下来把**==每组的Value计算出一个聚合值==**, 这个操作非常类似于MapReduce中的Reduce.</p> <p>ReduceByKey只能作用于Key-Value型数据(Tuple2) .</p> <p>ReduceByKey在Map端有一个Cominer, 这样 I/O 的数据便会减少.</p></blockquote> <ul><li><h5 id="语法-17"><a href="#语法-17" class="header-anchor">#</a> 语法</h5></li></ul> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token keyword">def</span> reduceByKey<span class="token punctuation">(</span>func<span class="token operator">:</span> <span class="token punctuation">(</span>V<span class="token punctuation">,</span> V<span class="token punctuation">)</span> ⇒ V<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li><h5 id="示例-16"><a href="#示例-16" class="header-anchor">#</a> 示例</h5></li></ul> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code>sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span>Seq<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span>reduceByKey<span class="token punctuation">(</span> <span class="token punctuation">(</span>curr<span class="token punctuation">,</span> agg<span class="token punctuation">)</span> <span class="token keyword">=&gt;</span> curr <span class="token operator">+</span> agg <span class="token punctuation">)</span>
  <span class="token punctuation">.</span>collect<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="groupbykey-聚合操作"><a href="#groupbykey-聚合操作" class="header-anchor">#</a> GroupByKey--聚合操作</h4> <blockquote><p>作用是按照Key分组,和ReduceByKey类似,但是GroupByKey并不求聚合,只是**==列举Key对应的所有Value==**</p></blockquote> <ul><li>语法</li></ul> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token keyword">def</span> groupByKey<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> RDD<span class="token punctuation">[</span><span class="token punctuation">(</span>K<span class="token punctuation">,</span> Iterable<span class="token punctuation">[</span>V<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li><h5 id="示例-17"><a href="#示例-17" class="header-anchor">#</a> 示例</h5></li></ul> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code>sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span>Seq<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span>groupByKey<span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span>collect<span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span>foreach<span class="token punctuation">(</span>println<span class="token punctuation">(</span>_<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="combinebykey-聚合操作"><a href="#combinebykey-聚合操作" class="header-anchor">#</a> CombineByKey--聚合操作</h4> <blockquote><p>对数据集按照Key分组进行 ==Value的聚合计算==</p> <p>groupByKey , reduceByKey 的底层都是 combineByKey.</p></blockquote> <ul><li><h5 id="语法-18"><a href="#语法-18" class="header-anchor">#</a> 语法</h5> <ul><li><strong>createCombiner</strong>  :  ==将Value进行初步转换==</li> <li><strong>mergeValue</strong> :   在每个分区把上一步转换的结果聚合计算</li> <li><strong>mergeCombiners</strong>  :  在所有分区上把每个分区的聚合结果聚合</li> <li><strong>partitioner</strong>  :  可选, 分区函数</li> <li><strong>mapSideCombiner</strong>  :  可选, 是否在Map端Combine</li> <li><strong>serializer</strong>  :  序列化器</li></ul></li></ul> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token keyword">def</span> combineByKey<span class="token punctuation">[</span>C<span class="token punctuation">]</span><span class="token punctuation">(</span>createCombiner<span class="token operator">:</span> V <span class="token keyword">=&gt;</span> C<span class="token punctuation">,</span>
                    mergeValue<span class="token operator">:</span> <span class="token punctuation">(</span>C<span class="token punctuation">,</span> V<span class="token punctuation">)</span> <span class="token keyword">=&gt;</span> C<span class="token punctuation">,</span>
                    mergeCombiners<span class="token operator">:</span> <span class="token punctuation">(</span>C<span class="token punctuation">,</span> C<span class="token punctuation">)</span> <span class="token keyword">=&gt;</span> C<span class="token punctuation">,</span>
                    partitioner<span class="token operator">:</span> Partitioner<span class="token punctuation">,</span>
                    mapSideCombine<span class="token operator">:</span> <span class="token builtin">Boolean</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span>
                    serializer<span class="token operator">:</span> Serializer <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li><h5 id="示例-18"><a href="#示例-18" class="header-anchor">#</a> 示例</h5></li></ul> <blockquote><p>需求 :   <strong>求平均值</strong></p></blockquote> <ul><li>方式1</li></ul> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token keyword">def</span> combineByKey<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    
    <span class="token comment">// 1. 准备集合</span>
    <span class="token keyword">val</span> rdd<span class="token operator">:</span> RDD<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token builtin">Double</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span>Seq<span class="token punctuation">(</span>
      <span class="token punctuation">(</span><span class="token string">&quot;zhangsan&quot;</span><span class="token punctuation">,</span> <span class="token number">99.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">(</span><span class="token string">&quot;zhangsan&quot;</span><span class="token punctuation">,</span> <span class="token number">96.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">(</span><span class="token string">&quot;lisi&quot;</span><span class="token punctuation">,</span> <span class="token number">97.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">(</span><span class="token string">&quot;lisi&quot;</span><span class="token punctuation">,</span> <span class="token number">98.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      <span class="token punctuation">(</span><span class="token string">&quot;zhangsan&quot;</span><span class="token punctuation">,</span> <span class="token number">97.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      
    <span class="token comment">// 2. 算子操作</span>
    
    <span class="token comment">//type用于封装数据类型为(Double, Int)在变量RDDType里</span>
    <span class="token keyword">type</span> RDDType <span class="token operator">=</span> <span class="token punctuation">(</span><span class="token builtin">Double</span><span class="token punctuation">,</span> <span class="token builtin">Int</span><span class="token punctuation">)</span>
    
    <span class="token keyword">val</span> combineResult <span class="token operator">=</span> rdd<span class="token punctuation">.</span>combineByKey<span class="token punctuation">(</span>
      createCombiner <span class="token operator">=</span> <span class="token punctuation">(</span>curr<span class="token operator">:</span> <span class="token builtin">Double</span><span class="token punctuation">)</span> <span class="token keyword">=&gt;</span> <span class="token punctuation">(</span>curr<span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      mergeValue <span class="token operator">=</span> <span class="token punctuation">(</span>curr<span class="token operator">:</span> RDDType<span class="token punctuation">,</span> nextValue<span class="token operator">:</span> <span class="token builtin">Double</span><span class="token punctuation">)</span> <span class="token keyword">=&gt;</span> <span class="token punctuation">(</span>curr<span class="token punctuation">.</span>_1 <span class="token operator">+</span> nextValue<span class="token punctuation">,</span> curr<span class="token punctuation">.</span>_2 <span class="token operator">+</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
      mergeCombiners <span class="token operator">=</span> <span class="token punctuation">(</span>curr<span class="token operator">:</span> RDDType<span class="token punctuation">,</span> agg<span class="token operator">:</span> RDDType<span class="token punctuation">)</span> <span class="token keyword">=&gt;</span> <span class="token punctuation">(</span>curr<span class="token punctuation">.</span>_1 <span class="token operator">+</span> agg<span class="token punctuation">.</span>_1<span class="token punctuation">,</span> curr<span class="token punctuation">.</span>_2 <span class="token operator">+</span> agg<span class="token punctuation">.</span>_2<span class="token punctuation">)</span>
    <span class="token punctuation">)</span>
    
    <span class="token comment">// (zhangsan,(292.0,3))   (lisi,(195.0,2))</span>
    <span class="token keyword">val</span> resultRDD <span class="token operator">=</span> combineResult<span class="token punctuation">.</span>map<span class="token punctuation">(</span>item <span class="token keyword">=&gt;</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span>_1<span class="token punctuation">,</span> item<span class="token punctuation">.</span>_2<span class="token punctuation">.</span>_1 <span class="token operator">/</span> item<span class="token punctuation">.</span>_2<span class="token punctuation">.</span>_2<span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment">// 3. 获取结果, 打印结果</span>
    resultRDD<span class="token punctuation">.</span>collect<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>foreach<span class="token punctuation">(</span>println<span class="token punctuation">(</span>_<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br></div></div><ul><li>方式2</li></ul> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token comment">/**
  * 利用groupbykey实现求平均分
  */</span>
<span class="token annotation punctuation">@Test</span>
<span class="token keyword">def</span> combineByKey2<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token comment">// 1. 准备集合</span>
  <span class="token keyword">val</span> rdd<span class="token operator">:</span> RDD<span class="token punctuation">[</span><span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token builtin">Double</span><span class="token punctuation">)</span><span class="token punctuation">]</span> <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span>Seq<span class="token punctuation">(</span>
    <span class="token punctuation">(</span><span class="token string">&quot;zhangsan&quot;</span><span class="token punctuation">,</span> <span class="token number">99.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token string">&quot;zhangsan&quot;</span><span class="token punctuation">,</span> <span class="token number">96.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token string">&quot;lisi&quot;</span><span class="token punctuation">,</span> <span class="token number">97.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token string">&quot;lisi&quot;</span><span class="token punctuation">,</span> <span class="token number">98.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span>
    <span class="token punctuation">(</span><span class="token string">&quot;zhangsan&quot;</span><span class="token punctuation">,</span> <span class="token number">97.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">)</span>

   rdd<span class="token punctuation">.</span>groupByKey<span class="token punctuation">(</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span>map<span class="token punctuation">(</span>x <span class="token keyword">=&gt;</span> <span class="token punctuation">{</span>
        x<span class="token punctuation">.</span>_1 <span class="token operator">-&gt;</span> x<span class="token punctuation">.</span>_2<span class="token punctuation">.</span>sum <span class="token operator">/</span> x<span class="token punctuation">.</span>_2<span class="token punctuation">.</span>size
      <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">.</span>collectAsMap<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>foreach<span class="token punctuation">(</span>println<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div><h4 id="aggregatebykey-聚合操作"><a href="#aggregatebykey-聚合操作" class="header-anchor">#</a> AggregateByKey--聚合操作</h4> <blockquote><p>应用场景 :  <strong>aggregateByKey 特别适合针对每个数据要先处理, 后聚合.</strong></p> <ul><li>与reduceByKey的区别
<ul><li>aggregateByKey 最终聚合结果的类型和传入的初始值类型保持一致</li> <li>reduceByKey 在集合中选取第一个值作为初始值, 并且聚合过的数据类型不能改变</li></ul></li></ul></blockquote> <ul><li><h5 id="语法-19"><a href="#语法-19" class="header-anchor">#</a> 语法</h5> <ul><li><strong>zeroValue</strong> :   ==指定初始值==</li> <li><strong>seqOp : (初始值, value)</strong> :     ==每一个元素的value与初始值进行计算.==</li> <li><strong>combOp : (value, agg)</strong> :      将seqOp的结果进行同key分组, ==聚合计算整组的value.==</li></ul></li></ul> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token keyword">def</span> aggregateByKey<span class="token punctuation">[</span>U<span class="token operator">:</span> ClassTag<span class="token punctuation">]</span><span class="token punctuation">(</span>zeroValue<span class="token operator">:</span> U<span class="token punctuation">)</span>
					<span class="token punctuation">(</span>seqOp<span class="token operator">:</span> <span class="token punctuation">(</span>U<span class="token punctuation">,</span> V<span class="token punctuation">)</span> <span class="token keyword">=&gt;</span> U<span class="token punctuation">,</span>combOp<span class="token operator">:</span> <span class="token punctuation">(</span>U<span class="token punctuation">,</span> U<span class="token punctuation">)</span> <span class="token keyword">=&gt;</span> U<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li><h5 id="示例-19"><a href="#示例-19" class="header-anchor">#</a> 示例</h5></li></ul> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token keyword">val</span> rdd <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span>Seq<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">&quot;手机&quot;</span><span class="token punctuation">,</span> <span class="token number">10.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">&quot;手机&quot;</span><span class="token punctuation">,</span> <span class="token number">15.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">&quot;电脑&quot;</span><span class="token punctuation">,</span> <span class="token number">20.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">val</span> result <span class="token operator">=</span> rdd<span class="token punctuation">.</span>aggregateByKey<span class="token punctuation">(</span><span class="token number">0.8</span><span class="token punctuation">)</span><span class="token punctuation">(</span>
  seqOp <span class="token operator">=</span> <span class="token punctuation">(</span>zero<span class="token punctuation">,</span> price<span class="token punctuation">)</span> <span class="token keyword">=&gt;</span> price <span class="token operator">*</span> zero<span class="token punctuation">,</span>
  combOp <span class="token operator">=</span> <span class="token punctuation">(</span>curr<span class="token punctuation">,</span> agg<span class="token punctuation">)</span> <span class="token keyword">=&gt;</span> curr <span class="token operator">+</span> agg
<span class="token punctuation">)</span><span class="token punctuation">.</span>collect<span class="token punctuation">(</span><span class="token punctuation">)</span>
println<span class="token punctuation">(</span>result<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><h4 id="foldbykey-聚合操作"><a href="#foldbykey-聚合操作" class="header-anchor">#</a> foldByKey--聚合操作</h4> <blockquote><p>首先按照Key分组, 然后**==聚合计算整组的value==<strong>, 和</strong>reduceByKey<strong>的区别是可以</strong>==指定初始值==**.</p> <p>foldByKey和 Scala中的fold区别是,</p> <ul><li><strong>fold</strong>的==<strong>初始值作用于整体的数据</strong>==</li></ul> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code>scala<span class="token operator">&gt;</span> Seq<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span><span class="token number">2</span><span class="token punctuation">,</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span>fold<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">(</span>_<span class="token operator">+</span>_<span class="token punctuation">)</span>
res6<span class="token operator">:</span> <span class="token builtin">Int</span> <span class="token operator">=</span> <span class="token number">16</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li><strong>foldByKey</strong>的**==初始值作用于每一个数据元素==**</li></ul></blockquote> <ul><li><h5 id="语法-20"><a href="#语法-20" class="header-anchor">#</a> 语法</h5> <ul><li><strong>zeroValue</strong> :  <strong>初始值</strong></li> <li><strong>func</strong>  :  <strong>==聚合计算整组的value==</strong></li></ul></li></ul> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token keyword">def</span> foldByKey<span class="token punctuation">(</span>zeroValue<span class="token operator">:</span> V<span class="token punctuation">)</span><span class="token punctuation">(</span>func<span class="token operator">:</span> <span class="token punctuation">(</span>V<span class="token punctuation">,</span> V<span class="token punctuation">)</span> <span class="token keyword">=&gt;</span> V<span class="token punctuation">)</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li><h5 id="示例-20"><a href="#示例-20" class="header-anchor">#</a> 示例</h5></li></ul> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code>sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span>Seq<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span>foldByKey<span class="token punctuation">(</span><span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token punctuation">(</span>curr<span class="token punctuation">,</span> agg<span class="token punctuation">)</span> <span class="token keyword">=&gt;</span> curr <span class="token operator">+</span> agg<span class="token punctuation">)</span>
  <span class="token punctuation">.</span>collect<span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span>foreach<span class="token punctuation">(</span>println<span class="token punctuation">(</span>_<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><h4 id="sortby-排序操作"><a href="#sortby-排序操作" class="header-anchor">#</a> SortBy--排序操作</h4> <blockquote><p>排序相关的算子有两个, 一个是**==sortBy==<strong>, 另外一个是</strong>==sortByKey==**</p></blockquote> <ul><li><h5 id="语法-21"><a href="#语法-21" class="header-anchor">#</a> 语法</h5> <ul><li><h5 id="sortby适用于-任何类型-rdd-sortbykey-只适用于kv类型-rdd"><a href="#sortby适用于-任何类型-rdd-sortbykey-只适用于kv类型-rdd" class="header-anchor">#</a> sortBy适用于==任何类型==RDD,  <strong>sortByKey==只适用于KV类型==RDD.</strong></h5></li> <li><h5 id="sortby可以按照-指定的任何部分-来排序-sortbykey-只能按照key-来排序"><a href="#sortby可以按照-指定的任何部分-来排序-sortbykey-只能按照key-来排序" class="header-anchor">#</a> sortBy可以按照==指定的任何部分==来排序, sortByKey==只能按照Key==来排序</h5></li></ul></li></ul> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token keyword">def</span> sortBy<span class="token punctuation">[</span>K<span class="token punctuation">]</span><span class="token punctuation">(</span>f<span class="token operator">:</span> <span class="token punctuation">(</span>T<span class="token punctuation">)</span> <span class="token keyword">=&gt;</span> K<span class="token punctuation">,</span>
              ascending<span class="token operator">:</span> <span class="token builtin">Boolean</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span>  <span class="token comment">//是否升序</span>
              numPartitions<span class="token operator">:</span> <span class="token builtin">Int</span> <span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>partitions<span class="token punctuation">.</span>length<span class="token punctuation">)</span>


<span class="token keyword">def</span> sortByKey<span class="token punctuation">(</span>ascending<span class="token operator">:</span> <span class="token builtin">Boolean</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">,</span> 
              numPartitions<span class="token operator">:</span> <span class="token builtin">Int</span> <span class="token operator">=</span> <span class="token keyword">self</span><span class="token punctuation">.</span>partitions<span class="token punctuation">.</span>length<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><ul><li><h5 id="示例-21"><a href="#示例-21" class="header-anchor">#</a> 示例</h5></li></ul> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code>  <span class="token keyword">def</span> sort<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token keyword">val</span> rddlist <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span>Seq<span class="token punctuation">(</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">8</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    <span class="token keyword">val</span> rddmap <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span>Seq<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">&quot;c&quot;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

    <span class="token comment">//sortBy适用于任何类型RDD</span>
    rddlist<span class="token punctuation">.</span>sortBy<span class="token punctuation">(</span>item <span class="token keyword">=&gt;</span> item<span class="token punctuation">)</span>

    <span class="token comment">//sortBy正序排序</span>
    rddmap<span class="token punctuation">.</span>sortBy<span class="token punctuation">(</span>item <span class="token keyword">=&gt;</span> item<span class="token punctuation">.</span>_2<span class="token punctuation">)</span>
    <span class="token comment">//sortBy降序排序</span>
    rddmap<span class="token punctuation">.</span>sortBy<span class="token punctuation">(</span>item <span class="token keyword">=&gt;</span> item<span class="token punctuation">.</span>_2<span class="token punctuation">,</span><span class="token boolean">false</span><span class="token punctuation">)</span>

    <span class="token comment">//sortByKey按照key排序</span>
    rddmap<span class="token punctuation">.</span>sortByKey<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">//sortByKey按照value排序</span>
    rddmap<span class="token punctuation">.</span>map<span class="token punctuation">(</span>item <span class="token keyword">=&gt;</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span>_2<span class="token punctuation">,</span> item<span class="token punctuation">.</span>_1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>sortByKey<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>map<span class="token punctuation">(</span>item <span class="token keyword">=&gt;</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span>_2<span class="token punctuation">,</span> item<span class="token punctuation">.</span>_1<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>collect<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>foreach<span class="token punctuation">(</span>println<span class="token punctuation">(</span>_<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br></div></div><h4 id="coalesce-重分区操作"><a href="#coalesce-重分区操作" class="header-anchor">#</a> Coalesce--重分区操作</h4> <blockquote><p>coalesce ==减少分区数== ; 进行重分区的时候, 默认是不Shuffle的, coalesce默认不能增大分区数.</p> <p>设置参数为true时, 即可增加分区数.</p></blockquote> <ul><li><h5 id="语法-22"><a href="#语法-22" class="header-anchor">#</a> 语法</h5></li></ul> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token keyword">def</span> coalesce<span class="token punctuation">(</span>numPartitions<span class="token operator">:</span> <span class="token builtin">Int</span><span class="token punctuation">,</span> shuffle<span class="token operator">:</span> <span class="token builtin">Boolean</span> <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span>
               partitionCoalescer<span class="token operator">:</span> Option<span class="token punctuation">[</span>PartitionCoalescer<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><ul><li><h5 id="示例-22"><a href="#示例-22" class="header-anchor">#</a> 示例</h5></li></ul> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token keyword">val</span> rdd <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span>Seq<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token comment">//减少分区数</span>
println<span class="token punctuation">(</span>rdd<span class="token punctuation">.</span>coalesce<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> shuffle <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">.</span>partitions<span class="token punctuation">.</span>size<span class="token punctuation">)</span>
<span class="token comment">//增加分区数</span>
println<span class="token punctuation">(</span>rdd<span class="token punctuation">.</span>coalesce<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">,</span> shuffle <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">.</span>partitions<span class="token punctuation">.</span>size<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="repartition-重分区操作"><a href="#repartition-重分区操作" class="header-anchor">#</a> Repartition--重分区操作</h4> <blockquote><p>repartition ==重新指定分区数== ; 进行重分区的时候, 默认是Shuffle的.</p></blockquote> <ul><li><h5 id="语法-23"><a href="#语法-23" class="header-anchor">#</a> 语法</h5></li></ul> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token keyword">def</span> repartition<span class="token punctuation">(</span>numPartitions<span class="token operator">:</span> <span class="token builtin">Int</span><span class="token punctuation">)</span> 
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li><h5 id="示例-23"><a href="#示例-23" class="header-anchor">#</a> 示例</h5></li></ul> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token keyword">val</span> rdd <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span>Seq<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span>
<span class="token comment">// repartition</span>
println<span class="token punctuation">(</span>rdd<span class="token punctuation">.</span>repartition<span class="token punctuation">(</span><span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">.</span>partitions<span class="token punctuation">.</span>size<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="cogroup-聚合操作"><a href="#cogroup-聚合操作" class="header-anchor">#</a> Cogroup--聚合操作</h4> <blockquote><p>多个 RDD 协同分组, 将多个 RDD 中 Key 相同的 Value 分组.</p></blockquote> <ul><li><h5 id="语法-24"><a href="#语法-24" class="header-anchor">#</a> 语法</h5></li></ul> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token keyword">def</span> cogroup<span class="token punctuation">[</span>W1<span class="token punctuation">,</span> W2<span class="token punctuation">,</span> W3<span class="token punctuation">]</span><span class="token punctuation">(</span>other1<span class="token operator">:</span> RDD<span class="token punctuation">[</span><span class="token punctuation">(</span>K<span class="token punctuation">,</span> W1<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      other2<span class="token operator">:</span> RDD<span class="token punctuation">[</span><span class="token punctuation">(</span>K<span class="token punctuation">,</span> W2<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      other3<span class="token operator">:</span> RDD<span class="token punctuation">[</span><span class="token punctuation">(</span>K<span class="token punctuation">,</span> W3<span class="token punctuation">)</span><span class="token punctuation">]</span><span class="token punctuation">,</span>
      partitioner<span class="token operator">:</span> Partitioner<span class="token punctuation">)</span>
      <span class="token operator">:</span> RDD<span class="token punctuation">[</span><span class="token punctuation">(</span>K<span class="token punctuation">,</span> <span class="token punctuation">(</span>Iterable<span class="token punctuation">[</span>V<span class="token punctuation">]</span><span class="token punctuation">,</span> Iterable<span class="token punctuation">[</span>W1<span class="token punctuation">]</span><span class="token punctuation">,</span> Iterable<span class="token punctuation">[</span>W2<span class="token punctuation">]</span><span class="token punctuation">,</span> Iterable<span class="token punctuation">[</span>W3<span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li><h5 id="示例-24"><a href="#示例-24" class="header-anchor">#</a> 示例</h5></li></ul> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token keyword">val</span> rdd1 <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span>Seq<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">&quot;c&quot;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">&quot;d&quot;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">val</span> rdd2 <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span>Seq<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">&quot;d&quot;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token keyword">val</span> rdd3 <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span>Seq<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">&quot;b&quot;</span><span class="token punctuation">,</span> <span class="token number">10</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token keyword">val</span> result1 <span class="token operator">=</span> rdd1<span class="token punctuation">.</span>cogroup<span class="token punctuation">(</span>rdd2<span class="token punctuation">)</span><span class="token punctuation">.</span>collect<span class="token punctuation">(</span><span class="token punctuation">)</span>
<span class="token keyword">val</span> result2 <span class="token operator">=</span> rdd1<span class="token punctuation">.</span>cogroup<span class="token punctuation">(</span>rdd2<span class="token punctuation">,</span> rdd3<span class="token punctuation">)</span><span class="token punctuation">.</span>collect<span class="token punctuation">(</span><span class="token punctuation">)</span>

<span class="token comment">/*
执行结果:
Array(
  (d,(CompactBuffer(2),CompactBuffer(3))),
  (a,(CompactBuffer(1, 2, 5),CompactBuffer(10))),
  (b,(CompactBuffer(2, 6),CompactBuffer(1))),
  (c,(CompactBuffer(3),CompactBuffer()))
)
 */</span>
println<span class="token punctuation">(</span>result1<span class="token punctuation">)</span>

<span class="token comment">/*
执行结果:
Array(
  (d,(CompactBuffer(2),CompactBuffer(3),CompactBuffer())),
  (a,(CompactBuffer(1, 2, 5),CompactBuffer(10),CompactBuffer(1))),
  (b,(CompactBuffer(2, 6),CompactBuffer(1),Co...
 */</span>
println<span class="token punctuation">(</span>result2<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br></div></div><h3 id="_3-action-算子"><a href="#_3-action-算子" class="header-anchor">#</a> 3. Action 算子</h3> <h4 id="reduce"><a href="#reduce" class="header-anchor">#</a> Reduce</h4> <blockquote><h5 id="对整个结果集规约-最终生成一条数据-是整个数据集的汇总"><a href="#对整个结果集规约-最终生成一条数据-是整个数据集的汇总" class="header-anchor">#</a> 对整个结果集规约, ==最终生成一条数据==, 是整个数据集的汇总.</h5></blockquote> <ul><li><h5 id="reduce和reducebykey的区别"><a href="#reduce和reducebykey的区别" class="header-anchor">#</a> Reduce和ReduceByKey的区别</h5> <ul><li>reduce是action的算子, 并不是Shuffled操作 ; reduceByKey是转换算子</li> <li>reduce适用于<strong>任何类型</strong>的数据, reduceByKey只适用于<strong>KV类型</strong>数据.</li> <li>reduce针对的是整个数据集进行聚合, 故只会<strong>生成1条结果</strong></li> <li>reduceByKey是按照key分组,然后聚合每组value,故会<strong>生成多条结果</strong></li></ul></li> <li><h5 id="语法-25"><a href="#语法-25" class="header-anchor">#</a> 语法</h5></li></ul> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token keyword">def</span> reduce<span class="token punctuation">(</span>f<span class="token operator">:</span> <span class="token punctuation">(</span>T<span class="token punctuation">,</span> T<span class="token punctuation">)</span> <span class="token keyword">=&gt;</span> T<span class="token punctuation">)</span><span class="token operator">:</span> T
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li><h5 id="示例-25"><a href="#示例-25" class="header-anchor">#</a> 示例</h5></li></ul> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token keyword">def</span> reduce<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token keyword">val</span> rdd <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span>Seq<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">&quot;手机&quot;</span><span class="token punctuation">,</span> <span class="token number">10.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">&quot;手机&quot;</span><span class="token punctuation">,</span> <span class="token number">15.0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">&quot;电脑&quot;</span><span class="token punctuation">,</span> <span class="token number">20.0</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token keyword">val</span> result<span class="token operator">:</span> <span class="token punctuation">(</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token builtin">Double</span><span class="token punctuation">)</span> <span class="token operator">=</span> rdd<span class="token punctuation">.</span>reduce<span class="token punctuation">(</span><span class="token punctuation">(</span>curr<span class="token punctuation">,</span> agg<span class="token punctuation">)</span> <span class="token keyword">=&gt;</span> <span class="token punctuation">(</span><span class="token string">&quot;总价&quot;</span><span class="token punctuation">,</span> curr<span class="token punctuation">.</span>_2 <span class="token operator">+</span> agg<span class="token punctuation">.</span>_2<span class="token punctuation">)</span> <span class="token punctuation">)</span>
  println<span class="token punctuation">(</span>result<span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><h4 id="collect"><a href="#collect" class="header-anchor">#</a> collect</h4> <blockquote><h5 id="以-数组的形式-返回数据集中-所有元素"><a href="#以-数组的形式-返回数据集中-所有元素" class="header-anchor">#</a> 以==数组的形式==返回数据集中==所有元素==.</h5></blockquote> <ul><li><h5 id="语法-26"><a href="#语法-26" class="header-anchor">#</a> 语法</h5></li></ul> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token comment">//返回的是Array类型</span>
<span class="token keyword">def</span> collect<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Array<span class="token punctuation">[</span>T<span class="token punctuation">]</span>


<span class="token comment">//返回的是Map类型</span>
<span class="token keyword">def</span> collectAsMap<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Map<span class="token punctuation">[</span>K<span class="token punctuation">,</span> V<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br></div></div><ul><li><h5 id="示例-26"><a href="#示例-26" class="header-anchor">#</a> 示例</h5></li></ul> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token comment">//返回的是Array类型</span>
<span class="token keyword">val</span> rdd <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span>Seq<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
rdd<span class="token punctuation">.</span>collect<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>foreach<span class="token punctuation">(</span>println<span class="token punctuation">(</span>_<span class="token punctuation">)</span><span class="token punctuation">)</span>


<span class="token comment">//返回的是Map类型</span>
<span class="token keyword">val</span> rdd <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span>Seq<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">&quot;c&quot;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">&quot;c&quot;</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
rdd<span class="token punctuation">.</span>collectAsMap<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>foreach<span class="token punctuation">(</span>println<span class="token punctuation">(</span>_<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><h4 id="foreach"><a href="#foreach" class="header-anchor">#</a> foreach</h4> <blockquote><h5 id="无序遍历整个数据集中每一个元素-由于是并行执行-所以是无序的"><a href="#无序遍历整个数据集中每一个元素-由于是并行执行-所以是无序的" class="header-anchor">#</a> ==无序遍历整个数据集中每一个元素==, 由于是并行执行,所以是无序的.</h5></blockquote> <ul><li><h5 id="语法-27"><a href="#语法-27" class="header-anchor">#</a> 语法</h5></li></ul> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token keyword">def</span> foreach<span class="token punctuation">(</span>f<span class="token operator">:</span> T <span class="token keyword">=&gt;</span> <span class="token builtin">Unit</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li><h5 id="示例-27"><a href="#示例-27" class="header-anchor">#</a> 示例</h5></li></ul> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token keyword">val</span> rdd <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span>Seq<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">//1.无序遍历</span>
rdd<span class="token punctuation">.</span>foreach<span class="token punctuation">(</span>println<span class="token punctuation">(</span>_<span class="token punctuation">)</span><span class="token punctuation">)</span>

<span class="token comment">//2.有序的遍历</span>
rdd<span class="token punctuation">.</span>collect<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>foreach<span class="token punctuation">(</span>println<span class="token punctuation">(</span>_<span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><h4 id="count"><a href="#count" class="header-anchor">#</a> count</h4> <blockquote><h5 id="求得整个数据集的-元素总个数"><a href="#求得整个数据集的-元素总个数" class="header-anchor">#</a> 求得整个数据集的==元素总个数==.</h5></blockquote> <ul><li><h5 id="语法-28"><a href="#语法-28" class="header-anchor">#</a> 语法</h5></li></ul> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token keyword">def</span> count<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Long</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li><h5 id="示例-28"><a href="#示例-28" class="header-anchor">#</a> 示例</h5></li></ul> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token keyword">val</span> rdd <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span>Seq<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">&quot;c&quot;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">&quot;c&quot;</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
println<span class="token punctuation">(</span>rdd<span class="token punctuation">.</span>count<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>	<span class="token comment">//4</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="countbykey"><a href="#countbykey" class="header-anchor">#</a> countByKey</h4> <blockquote><h5 id="求得整个数据集中-key以及对应key出现的次数-返回值为-map-key-count-key"><a href="#求得整个数据集中-key以及对应key出现的次数-返回值为-map-key-count-key" class="header-anchor">#</a> 求得整个数据集中==Key以及对应Key出现的次数==. 返回值为 ==Map(Key , count(Key))==</h5> <h5 id="如果要-解决数据倾斜-的问题-是要先知道谁倾斜-通过countbykey可以查看key对应的数据总数-从而解决倾斜问题"><a href="#如果要-解决数据倾斜-的问题-是要先知道谁倾斜-通过countbykey可以查看key对应的数据总数-从而解决倾斜问题" class="header-anchor">#</a> 如果要==解决数据倾斜==的问题, 是要先知道谁倾斜, 通过countByKey可以查看Key对应的数据总数, 从而解决倾斜问题</h5></blockquote> <ul><li><h5 id="语法-29"><a href="#语法-29" class="header-anchor">#</a> 语法</h5></li></ul> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token keyword">def</span> countByKey<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> Map<span class="token punctuation">[</span>K<span class="token punctuation">,</span> <span class="token builtin">Long</span><span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li><h5 id="示例-29"><a href="#示例-29" class="header-anchor">#</a> 示例</h5></li></ul> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token keyword">val</span> rdd <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span>Seq<span class="token punctuation">(</span><span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">&quot;a&quot;</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">&quot;c&quot;</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token punctuation">(</span><span class="token string">&quot;c&quot;</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
println<span class="token punctuation">(</span>rdd<span class="token punctuation">.</span>countByKey<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>	<span class="token comment">//Map(a -&gt; 2, c -&gt; 2)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="first"><a href="#first" class="header-anchor">#</a> first</h4> <blockquote><h5 id="first只是-获取第一个元素-所以first-只会处理第一个分区-所以速度很快-无序处理所有数据"><a href="#first只是-获取第一个元素-所以first-只会处理第一个分区-所以速度很快-无序处理所有数据" class="header-anchor">#</a> first只是==获取第一个元素==, 所以first==只会处理第一个分区==, 所以速度很快, 无序处理所有数据</h5></blockquote> <ul><li><h5 id="语法-30"><a href="#语法-30" class="header-anchor">#</a> 语法</h5></li></ul> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token keyword">def</span> first<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> T
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li><h5 id="示例-30"><a href="#示例-30" class="header-anchor">#</a> 示例</h5></li></ul> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token keyword">val</span> rdd <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span>Seq<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
println<span class="token punctuation">(</span>rdd<span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">)</span>	<span class="token comment">//1</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h4 id="take"><a href="#take" class="header-anchor">#</a> take</h4> <blockquote><h5 id="返回整个数据集中-前-n-个元素"><a href="#返回整个数据集中-前-n-个元素" class="header-anchor">#</a> 返回整个数据集中==前 N 个元素==</h5> <p>==<strong>取Top-N的数据</strong> ----  sortBy+take(N)==</p></blockquote> <ul><li><h5 id="语法-31"><a href="#语法-31" class="header-anchor">#</a> 语法</h5></li></ul> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token keyword">def</span> take<span class="token punctuation">(</span>num<span class="token operator">:</span> <span class="token builtin">Int</span><span class="token punctuation">)</span><span class="token operator">:</span> Array<span class="token punctuation">[</span>T<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li><h5 id="示例-31"><a href="#示例-31" class="header-anchor">#</a> 示例</h5></li></ul> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token keyword">val</span> rdd <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span>Seq<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
rdd<span class="token punctuation">.</span>take<span class="token punctuation">(</span><span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span>foreach<span class="token punctuation">(</span>item <span class="token keyword">=&gt;</span> println<span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">// 1 2 3 </span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h4 id="takesample"><a href="#takesample" class="header-anchor">#</a> takeSample</h4> <blockquote><h5 id="类似于sample-区别在这是一个action-也是-采样获取数据-并直接返回结果"><a href="#类似于sample-区别在这是一个action-也是-采样获取数据-并直接返回结果" class="header-anchor">#</a> 类似于sample, 区别在这是一个Action, 也是==采样获取数据==, 并直接返回结果.</h5></blockquote> <ul><li><h5 id="语法-32"><a href="#语法-32" class="header-anchor">#</a> 语法</h5> <ul><li><strong>num</strong>  :  指拿出元素个数</li></ul></li></ul> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token keyword">def</span> takeSample<span class="token punctuation">(</span>
      withReplacement<span class="token operator">:</span> <span class="token builtin">Boolean</span><span class="token punctuation">,</span>
      num<span class="token operator">:</span> <span class="token builtin">Int</span><span class="token punctuation">,</span>
      seed<span class="token operator">:</span> <span class="token builtin">Long</span> <span class="token operator">=</span> Utils<span class="token punctuation">.</span>random<span class="token punctuation">.</span>nextLong<span class="token punctuation">)</span><span class="token operator">:</span> Array<span class="token punctuation">[</span>T<span class="token punctuation">]</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br></div></div><ul><li><h5 id="示例-32"><a href="#示例-32" class="header-anchor">#</a> 示例</h5></li></ul> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token keyword">val</span> rdd <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span>Seq<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">6</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
rdd<span class="token punctuation">.</span>takeSample<span class="token punctuation">(</span>withReplacement <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">,</span> num <span class="token operator">=</span> <span class="token number">3</span><span class="token punctuation">)</span><span class="token punctuation">.</span>foreach<span class="token punctuation">(</span>item <span class="token keyword">=&gt;</span> println<span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token comment">//3 5 6</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br></div></div><h3 id="_4-rdd对不同类型数据的支持"><a href="#_4-rdd对不同类型数据的支持" class="header-anchor">#</a> 4. RDD对不同类型数据的支持</h3> <h4 id="rdd数据类型分类-2"><a href="#rdd数据类型分类-2" class="header-anchor">#</a> RDD数据类型分类</h4> <ul><li><strong>字符串 :</strong> 对于字符串类型是比较基础的一些的操作, 诸如 map, flatMap, filter 等基础的算子.</li> <li><strong>键值对 :</strong> 对于键值对类型的数据, 有额外的支持, 诸如 reduceByKey, groupByKey 等 byKey 的算子.</li> <li><strong>数字型 :</strong> 对于数字型的数据也有额外的支持, 诸如 max, min 等.</li></ul> <h4 id="rdd-对键值对数据的额外支持"><a href="#rdd-对键值对数据的额外支持" class="header-anchor">#</a> RDD 对键值对数据的额外支持</h4> <blockquote><h5 id="键值型数据本质上就是一个二元元组-键值对类型的rdd表示为-rdd-k-v"><a href="#键值型数据本质上就是一个二元元组-键值对类型的rdd表示为-rdd-k-v" class="header-anchor">#</a> 键值型数据本质上就是一个二元元组, 键值对类型的RDD表示为 RDD[(K, V)]</h5> <blockquote><h5 id="rdd对键值对的额外支持是通过隐式支持来完成的-一个rdd-k-v-可以被隐式转换为一个-pairrddfunctions-对象-从而调用其中的方法"><a href="#rdd对键值对的额外支持是通过隐式支持来完成的-一个rdd-k-v-可以被隐式转换为一个-pairrddfunctions-对象-从而调用其中的方法" class="header-anchor">#</a> RDD对键值对的额外支持是通过隐式支持来完成的, 一个RDD[(K, V)]可以被隐式转换为一个 PairRDDFunctions 对象, 从而调用其中的方法.</h5></blockquote></blockquote> <ul><li><h5 id="pairrddfunctions-类中的方法"><a href="#pairrddfunctions-类中的方法" class="header-anchor">#</a> ==PairRDDFunctions==类中的方法</h5></li></ul> <table><thead><tr><th style="text-align:left;">类别</th> <th style="text-align:left;">算子</th></tr></thead> <tbody><tr><td style="text-align:left;">聚合操作</td> <td style="text-align:left;">reduceByKey</td></tr> <tr><td style="text-align:left;"></td> <td style="text-align:left;">foldByKey</td></tr> <tr><td style="text-align:left;"></td> <td style="text-align:left;">combineByKey</td></tr> <tr><td style="text-align:left;">分组操作</td> <td style="text-align:left;">cogroup</td></tr> <tr><td style="text-align:left;"></td> <td style="text-align:left;">groupByKey</td></tr> <tr><td style="text-align:left;">连接操作</td> <td style="text-align:left;">join</td></tr> <tr><td style="text-align:left;"></td> <td style="text-align:left;">leftOuterJoin</td></tr> <tr><td style="text-align:left;"></td> <td style="text-align:left;">rightOuterJoin</td></tr> <tr><td style="text-align:left;">排序操作</td> <td style="text-align:left;">sortBy</td></tr> <tr><td style="text-align:left;"></td> <td style="text-align:left;">sortByKey</td></tr> <tr><td style="text-align:left;">Action</td> <td style="text-align:left;">countByKey</td></tr> <tr><td style="text-align:left;"></td> <td style="text-align:left;">take</td></tr> <tr><td style="text-align:left;"></td> <td style="text-align:left;">collect</td></tr></tbody></table> <h4 id="rdd-对数字型数据的额外支持"><a href="#rdd-对数字型数据的额外支持" class="header-anchor">#</a> RDD 对数字型数据的额外支持</h4> <blockquote><h5 id="对于数字型数据的额外支持基本上都是-action-操作-而不是转换操作"><a href="#对于数字型数据的额外支持基本上都是-action-操作-而不是转换操作" class="header-anchor">#</a> 对于数字型数据的额外支持基本上都是 ==Action 操作==, 而不是转换操作.</h5></blockquote> <table><thead><tr><th style="text-align:left;">算子</th> <th style="text-align:left;">含义</th></tr></thead> <tbody><tr><td style="text-align:left;">count</td> <td style="text-align:left;">个数</td></tr> <tr><td style="text-align:left;">mean</td> <td style="text-align:left;">均值</td></tr> <tr><td style="text-align:left;">sum</td> <td style="text-align:left;">求和</td></tr> <tr><td style="text-align:left;">max</td> <td style="text-align:left;">最大值</td></tr> <tr><td style="text-align:left;">min</td> <td style="text-align:left;">最小值</td></tr> <tr><td style="text-align:left;">variance</td> <td style="text-align:left;">方差</td></tr> <tr><td style="text-align:left;">sampleVariance</td> <td style="text-align:left;">从采样中计算方差</td></tr> <tr><td style="text-align:left;">stdev</td> <td style="text-align:left;">标准差</td></tr> <tr><td style="text-align:left;">sampleStdev</td> <td style="text-align:left;">采样的标准差</td></tr></tbody></table> <h2 id="rdd缓存"><a href="#rdd缓存" class="header-anchor">#</a> RDD缓存</h2> <ul><li><h5 id="案例"><a href="#案例" class="header-anchor">#</a> 案例</h5></li></ul> <blockquote><p>需求: 在日志文件中找到访问次数最少的 IP 和访问次数最多的 IP</p></blockquote> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token keyword">def</span> prepare<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token comment">// 1. 创建 SC</span>
    <span class="token keyword">val</span> conf <span class="token operator">=</span> <span class="token keyword">new</span> SparkConf<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setAppName<span class="token punctuation">(</span><span class="token string">&quot;cache_prepare&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setMaster<span class="token punctuation">(</span><span class="token string">&quot;local[6]&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">val</span> sc <span class="token operator">=</span> <span class="token keyword">new</span> SparkContext<span class="token punctuation">(</span>conf<span class="token punctuation">)</span>

    <span class="token comment">// 2. 读取文件</span>
    <span class="token keyword">val</span> source <span class="token operator">=</span> sc<span class="token punctuation">.</span>textFile<span class="token punctuation">(</span><span class="token string">&quot;dataset/access_log_sample.txt&quot;</span><span class="token punctuation">)</span>

    <span class="token comment">// 3. 取出IP, 赋予初始频率</span>
    <span class="token keyword">val</span> countRDD <span class="token operator">=</span> source<span class="token punctuation">.</span>map<span class="token punctuation">(</span> item <span class="token keyword">=&gt;</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>

    <span class="token comment">// 4. 数据清洗</span>
    <span class="token keyword">val</span> cleanRDD <span class="token operator">=</span> countRDD<span class="token punctuation">.</span>filter<span class="token punctuation">(</span> item <span class="token keyword">=&gt;</span> StringUtils<span class="token punctuation">.</span>isNotEmpty<span class="token punctuation">(</span>item<span class="token punctuation">.</span>_1<span class="token punctuation">)</span> <span class="token punctuation">)</span>

    <span class="token comment">// 5. 统计IP出现的次数(聚合)</span>
    <span class="token keyword">val</span> aggRDD <span class="token operator">=</span> cleanRDD<span class="token punctuation">.</span>reduceByKey<span class="token punctuation">(</span> <span class="token punctuation">(</span>curr<span class="token punctuation">,</span> agg<span class="token punctuation">)</span> <span class="token keyword">=&gt;</span> curr <span class="token operator">+</span> agg <span class="token punctuation">)</span>

    <span class="token comment">// 6. 统计出现次数最少的IP(得出结论)</span>
    <span class="token keyword">val</span> lessIp <span class="token operator">=</span> aggRDD<span class="token punctuation">.</span>sortBy<span class="token punctuation">(</span>item <span class="token keyword">=&gt;</span> item<span class="token punctuation">.</span>_2<span class="token punctuation">,</span> ascending <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token comment">// 7. 统计出现次数最多的IP(得出结论)</span>
    <span class="token keyword">val</span> moreIp <span class="token operator">=</span> aggRDD<span class="token punctuation">.</span>sortBy<span class="token punctuation">(</span>item <span class="token keyword">=&gt;</span> item<span class="token punctuation">.</span>_2<span class="token punctuation">,</span> ascending <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>

    println<span class="token punctuation">(</span><span class="token punctuation">(</span>lessIp<span class="token punctuation">,</span> moreIp<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br></div></div><h3 id="缓存的意义"><a href="#缓存的意义" class="header-anchor">#</a> 缓存的意义</h3> <blockquote><h5 id="缓存能够帮助开发者在进行一些昂贵操作后-将其结果保存下来-以便下次使用无需再次执行-缓存能够显著的提升性能"><a href="#缓存能够帮助开发者在进行一些昂贵操作后-将其结果保存下来-以便下次使用无需再次执行-缓存能够显著的提升性能" class="header-anchor">#</a> 缓存能够帮助开发者在进行一些昂贵操作后, 将其结果保存下来, 以便下次使用无需再次执行, 缓存能够显著的提升性能.</h5></blockquote> <ul><li><h5 id="_1-减少shuffle操作"><a href="#_1-减少shuffle操作" class="header-anchor">#</a> 1. 减少shuffle操作</h5></li></ul> <blockquote><h5 id="一个rdd被使用多次时-会触发多个job运行-使用缓存可以提升性能-减少shuffle操作"><a href="#一个rdd被使用多次时-会触发多个job运行-使用缓存可以提升性能-减少shuffle操作" class="header-anchor">#</a> 一个rdd被使用多次时,会触发多个job运行, 使用缓存可以提升性能,减少shuffle操作.</h5></blockquote> <ul><li><h5 id="_2-解决容错问题"><a href="#_2-解决容错问题" class="header-anchor">#</a> 2. 解决容错问题</h5></li></ul> <blockquote><h5 id="避免后续的rdd出现异常-重新计算"><a href="#避免后续的rdd出现异常-重新计算" class="header-anchor">#</a> 避免后续的rdd出现异常,重新计算</h5></blockquote> <h3 id="缓存api"><a href="#缓存api" class="header-anchor">#</a> 缓存API</h3> <h4 id="_1-使用cache方法进行缓存"><a href="#_1-使用cache方法进行缓存" class="header-anchor">#</a> 1. 使用cache方法进行缓存</h4> <ul><li><h5 id="语法-33"><a href="#语法-33" class="header-anchor">#</a> 语法</h5></li></ul> <blockquote><p>cache 方法其实是 persist 方法的一个别名</p></blockquote> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token keyword">def</span> cache<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token keyword">type</span> <span class="token operator">=</span> persist<span class="token punctuation">(</span><span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li><h5 id="示例-33"><a href="#示例-33" class="header-anchor">#</a> 示例</h5></li></ul> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token keyword">val</span> RDD <span class="token operator">=</span> aggRDD<span class="token punctuation">.</span>cache<span class="token punctuation">(</span> <span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><h4 id="_2-使用persist方法进行缓存"><a href="#_2-使用persist方法进行缓存" class="header-anchor">#</a> 2. 使用persist方法进行缓存</h4> <ul><li><h5 id="语法-34"><a href="#语法-34" class="header-anchor">#</a> 语法</h5> <ul><li><strong>StorageLevel</strong>  :  缓存的级别</li></ul></li></ul> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token comment">//方式1</span>
<span class="token keyword">def</span> persist<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token keyword">type</span> <span class="token operator">=</span> persist<span class="token punctuation">(</span>StorageLevel<span class="token punctuation">.</span>MEMORY_ONLY<span class="token punctuation">)</span>

<span class="token comment">//方式2</span>
<span class="token keyword">def</span> persist<span class="token punctuation">(</span>newLevel<span class="token operator">:</span> StorageLevel<span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token keyword">type</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br></div></div><ul><li><h5 id="示例-34"><a href="#示例-34" class="header-anchor">#</a> 示例</h5></li></ul> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token keyword">val</span> RDD <span class="token operator">=</span> aggRDD<span class="token punctuation">.</span>persist<span class="token punctuation">(</span> <span class="token punctuation">)</span>
<span class="token keyword">val</span> RDD <span class="token operator">=</span> aggRDD<span class="token punctuation">.</span>persist<span class="token punctuation">(</span>StorageLevel<span class="token punctuation">.</span>MEMORY_ONLY<span class="token punctuation">)</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br></div></div><h3 id="缓存级别"><a href="#缓存级别" class="header-anchor">#</a> 缓存级别</h3> <ul><li><h4 id="查看缓存级别"><a href="#查看缓存级别" class="header-anchor">#</a> 查看缓存级别</h4></li></ul> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token keyword">def</span> getStorageLevel<span class="token operator">:</span> StorageLevel <span class="token operator">=</span> storageLevel
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li><h4 id="清理缓存"><a href="#清理缓存" class="header-anchor">#</a> 清理缓存</h4></li></ul> <blockquote><h5 id="指定删除rdd对应的缓存信息-并指定缓存级别为none"><a href="#指定删除rdd对应的缓存信息-并指定缓存级别为none" class="header-anchor">#</a> 指定删除RDD对应的缓存信息, 并指定缓存级别为NONE.</h5></blockquote> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token keyword">def</span> unpersist<span class="token punctuation">(</span>blocking<span class="token operator">:</span> <span class="token builtin">Boolean</span> <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token keyword">this</span><span class="token punctuation">.</span><span class="token keyword">type</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li><h4 id="分区级别选择"><a href="#分区级别选择" class="header-anchor">#</a> 分区级别选择</h4> <ul><li><h5 id="一般情况下默认存储级别-memory-only-即可"><a href="#一般情况下默认存储级别-memory-only-即可" class="header-anchor">#</a> <strong>一般情况下默认存储级别</strong> ==MEMORY_ONLY==  即可.</h5></li> <li><p>若数据量过大的情况, 可以选择级别为 MEMORY_ONLY_SER .</p></li> <li><p>若数据量大且数据昂贵的情况, 可以选择级别为  MEMORY_AND_DISK .</p></li> <li><p>若需要快速故障恢复, 可以选择复制的存储级别.</p></li></ul></li></ul> <blockquote><blockquote><p>是否以反序列化形式存储;</p> <ul><li>如果是true,存储的是对象;</li> <li>如果false, 则储存的是序列化过后的值(二进制的数据).</li></ul></blockquote> <p>SER : 表示以二进制数据来储存</p></blockquote> <table><thead><tr><th style="text-align:left;">缓存级别</th> <th style="text-align:left;">userDisk 是否使用磁盘</th> <th style="text-align:left;"><code>useMemory</code> 是否使用内存</th> <th style="text-align:left;">useOffHeap 是否使用堆外内存</th> <th style="text-align:left;">deserialized 是否以反序列化形式存储</th> <th style="text-align:left;"><code>replication</code> 副本数</th></tr></thead> <tbody><tr><td style="text-align:left;"><code>NONE</code></td> <td style="text-align:left;">false</td> <td style="text-align:left;">false</td> <td style="text-align:left;">false</td> <td style="text-align:left;">false</td> <td style="text-align:left;">1</td></tr> <tr><td style="text-align:left;"><code>DISK_ONLY</code></td> <td style="text-align:left;">true</td> <td style="text-align:left;">false</td> <td style="text-align:left;">false</td> <td style="text-align:left;">false</td> <td style="text-align:left;">1</td></tr> <tr><td style="text-align:left;"><code>DISK_ONLY_2</code></td> <td style="text-align:left;">true</td> <td style="text-align:left;">false</td> <td style="text-align:left;">false</td> <td style="text-align:left;">false</td> <td style="text-align:left;">2</td></tr> <tr><td style="text-align:left;"><code>MEMORY_ONLY</code></td> <td style="text-align:left;">false</td> <td style="text-align:left;">true</td> <td style="text-align:left;">false</td> <td style="text-align:left;">true</td> <td style="text-align:left;">1</td></tr> <tr><td style="text-align:left;"><code>MEMORY_ONLY_2</code></td> <td style="text-align:left;">false</td> <td style="text-align:left;">true</td> <td style="text-align:left;">false</td> <td style="text-align:left;">true</td> <td style="text-align:left;">2</td></tr> <tr><td style="text-align:left;">MEMORY_ONLY_SER</td> <td style="text-align:left;">false</td> <td style="text-align:left;">true</td> <td style="text-align:left;">false</td> <td style="text-align:left;">false</td> <td style="text-align:left;">1</td></tr> <tr><td style="text-align:left;"><code>MEMORY_ONLY_SER_2</code></td> <td style="text-align:left;">false</td> <td style="text-align:left;">true</td> <td style="text-align:left;">false</td> <td style="text-align:left;">false</td> <td style="text-align:left;">2</td></tr> <tr><td style="text-align:left;"><code>MEMORY_AND_DISK</code></td> <td style="text-align:left;">true</td> <td style="text-align:left;">true</td> <td style="text-align:left;">false</td> <td style="text-align:left;">true</td> <td style="text-align:left;">1</td></tr> <tr><td style="text-align:left;"><code>MEMORY_AND_DISK</code></td> <td style="text-align:left;">true</td> <td style="text-align:left;">true</td> <td style="text-align:left;">false</td> <td style="text-align:left;">true</td> <td style="text-align:left;">2</td></tr> <tr><td style="text-align:left;"><code>MEMORY_AND_DISK_SER</code></td> <td style="text-align:left;">true</td> <td style="text-align:left;">true</td> <td style="text-align:left;">false</td> <td style="text-align:left;">false</td> <td style="text-align:left;">1</td></tr> <tr><td style="text-align:left;"><code>MEMORY_AND_DISK_SER_2</code></td> <td style="text-align:left;">true</td> <td style="text-align:left;">true</td> <td style="text-align:left;">false</td> <td style="text-align:left;">false</td> <td style="text-align:left;">2</td></tr> <tr><td style="text-align:left;">OFF_HEAP</td> <td style="text-align:left;">true</td> <td style="text-align:left;">true</td> <td style="text-align:left;">true</td> <td style="text-align:left;">false</td> <td style="text-align:left;">1</td></tr></tbody></table> <h2 id="checkpoint"><a href="#checkpoint" class="header-anchor">#</a> Checkpoint</h2> <h3 id="checkpoint的作用"><a href="#checkpoint的作用" class="header-anchor">#</a> Checkpoint的作用</h3> <ul><li><h5 id="checkpoint的主要作用是斩断rdd的依赖链-并且将数据存储在可靠的存储引擎中"><a href="#checkpoint的主要作用是斩断rdd的依赖链-并且将数据存储在可靠的存储引擎中" class="header-anchor">#</a> Checkpoint的主要作用是斩断RDD的依赖链, 并且将数据存储在可靠的存储引擎中.</h5></li></ul> <h3 id="checkpoint的方式"><a href="#checkpoint的方式" class="header-anchor">#</a> Checkpoint的方式</h3> <ul><li><strong>可靠的</strong>  ----   将数据存储在可靠的存储引擎中, 例如 ==HDFS==</li> <li><strong>本地的</strong>  ----   将数据存储在==本地==</li></ul> <h3 id="checkpoint和cache的区别"><a href="#checkpoint和cache的区别" class="header-anchor">#</a> Checkpoint和Cache的区别</h3> <blockquote><ul><li><strong>Cache</strong> 可以把RDD计算出来然后放在内存中,但是 RDD 的依赖链是不能丢掉的,因为这种缓存是不可靠的,如果出现了一些错误,这个RDD的容错就只能通过回溯依赖链,重新计算出来.</li> <li><strong>Checkpoint</strong> 把结果保存在HDFS这类存储中,就是可靠的了,所以可以斩断依赖,如果出错了,则通过复制 HDFS 中的文件来实现容错.</li></ul></blockquote> <ol><li>Checkpoint 可以<strong>保存数据到HDFS这类可靠的存储</strong>上, Persist和 Cache只能<strong>保存在本地的磁盘和内存</strong>中.</li> <li>Checkpoint 可以斩断RDD的依赖链,而Persist和Cache不行.</li> <li>因为CheckpointRDD没有向上的依赖链,所以程序结束后依然存在,不会被删除. 而Cache和Persist会在程序结束后立刻被清除.</li></ol> <h3 id="checkpoint的使用"><a href="#checkpoint的使用" class="header-anchor">#</a> Checkpoint的使用</h3> <ul><li><h5 id="语法-35"><a href="#语法-35" class="header-anchor">#</a> 语法</h5></li></ul> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token keyword">def</span> checkpoint<span class="token punctuation">(</span> <span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br></div></div><ul><li><h5 id="实现步骤"><a href="#实现步骤" class="header-anchor">#</a> 实现步骤</h5> <ol><li><p>==<strong>设置Checkpoint的存储路径</strong>.==</p></li> <li><h5 id="先开启cache-再开启checkpoint"><a href="#先开启cache-再开启checkpoint" class="header-anchor">#</a> ==<strong>先开启Cache</strong> , 再开启Checkpoint==</h5> <blockquote><p>checkpoint会重新计算整个RDD的数据然后再存入HDFS等地方; 开启cache可以提高性能.</p></blockquote></li></ol></li> <li><h5 id="代码实现"><a href="#代码实现" class="header-anchor">#</a> 代码实现</h5></li></ul> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token keyword">def</span> checkpoint<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token keyword">val</span> conf <span class="token operator">=</span> <span class="token keyword">new</span> SparkConf<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setAppName<span class="token punctuation">(</span><span class="token string">&quot;cache_prepare&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setMaster<span class="token punctuation">(</span><span class="token string">&quot;local[6]&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">val</span> sc <span class="token operator">=</span> <span class="token keyword">new</span> SparkContext<span class="token punctuation">(</span>conf<span class="token punctuation">)</span>
    <span class="token comment">// 设置保存 checkpoint 的目录, 也可以设置为 HDFS 上的目录</span>
    sc<span class="token punctuation">.</span>setCheckpointDir<span class="token punctuation">(</span><span class="token string">&quot;checkpoint&quot;</span><span class="token punctuation">)</span>

    <span class="token keyword">val</span> source <span class="token operator">=</span> sc<span class="token punctuation">.</span>textFile<span class="token punctuation">(</span><span class="token string">&quot;dataset/access_log_sample.txt&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">val</span> countRDD <span class="token operator">=</span> source<span class="token punctuation">.</span>map<span class="token punctuation">(</span> item <span class="token keyword">=&gt;</span> <span class="token punctuation">(</span>item<span class="token punctuation">.</span>split<span class="token punctuation">(</span><span class="token string">&quot; &quot;</span><span class="token punctuation">)</span><span class="token punctuation">(</span><span class="token number">0</span><span class="token punctuation">)</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">)</span> <span class="token punctuation">)</span>
    <span class="token keyword">val</span> cleanRDD <span class="token operator">=</span> countRDD<span class="token punctuation">.</span>filter<span class="token punctuation">(</span> item <span class="token keyword">=&gt;</span> StringUtils<span class="token punctuation">.</span>isNotEmpty<span class="token punctuation">(</span>item<span class="token punctuation">.</span>_1<span class="token punctuation">)</span> <span class="token punctuation">)</span>
    <span class="token keyword">var</span> aggRDD <span class="token operator">=</span> cleanRDD<span class="token punctuation">.</span>reduceByKey<span class="token punctuation">(</span> <span class="token punctuation">(</span>curr<span class="token punctuation">,</span> agg<span class="token punctuation">)</span> <span class="token keyword">=&gt;</span> curr <span class="token operator">+</span> agg <span class="token punctuation">)</span>

    <span class="token comment">// 如果调用 checkpoint, 则会重新计算一下 RDD, 然后把结果存在 HDFS 或者本地目录中</span>
    <span class="token comment">// 所以,应该在 Checkpoint 之前, 进行一次 Cache</span>
    aggRDD <span class="token operator">=</span> aggRDD<span class="token punctuation">.</span>cache<span class="token punctuation">(</span><span class="token punctuation">)</span>
    aggRDD<span class="token punctuation">.</span>checkpoint<span class="token punctuation">(</span><span class="token punctuation">)</span>

    <span class="token keyword">val</span> lessIp <span class="token operator">=</span> aggRDD<span class="token punctuation">.</span>sortBy<span class="token punctuation">(</span>item <span class="token keyword">=&gt;</span> item<span class="token punctuation">.</span>_2<span class="token punctuation">,</span> ascending <span class="token operator">=</span> <span class="token boolean">true</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token keyword">val</span> moreIp <span class="token operator">=</span> aggRDD<span class="token punctuation">.</span>sortBy<span class="token punctuation">(</span>item <span class="token keyword">=&gt;</span> item<span class="token punctuation">.</span>_2<span class="token punctuation">,</span> ascending <span class="token operator">=</span> <span class="token boolean">false</span><span class="token punctuation">)</span><span class="token punctuation">.</span>first<span class="token punctuation">(</span><span class="token punctuation">)</span>
    println<span class="token punctuation">(</span><span class="token punctuation">(</span>lessIp<span class="token punctuation">,</span> moreIp<span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br></div></div><h2 id="spark分布式共享变量"><a href="#spark分布式共享变量" class="header-anchor">#</a> Spark分布式共享变量</h2> <blockquote><h5 id="跨机器-作用域-访问变量"><a href="#跨机器-作用域-访问变量" class="header-anchor">#</a> 跨机器(作用域)访问变量.</h5> <p>两种共享变量：<strong>广播变量</strong>（broadcast variable）与 <strong>累加器</strong>（accumulator）</p> <p>累加器用来对<strong>信息进行聚合</strong>，而广播变量用来<strong>高效分发较大的对象</strong></p></blockquote> <h3 id="spark闭包分发"><a href="#spark闭包分发" class="header-anchor">#</a> spark闭包分发</h3> <p><strong>闭包</strong></p> <blockquote><h5 id="概念-一个函数携带了一个外包的作用域-这种函数我们称之为叫做闭包-在scala中的闭包本质上就是一个对象-是-functionx-的实例"><a href="#概念-一个函数携带了一个外包的作用域-这种函数我们称之为叫做闭包-在scala中的闭包本质上就是一个对象-是-functionx-的实例" class="header-anchor">#</a> <strong>概念</strong> :  ==一个函数携带了一个外包的作用域, 这种函数我们称之为叫做闭包==.  在Scala中的闭包本质上就是一个对象, 是 FunctionX 的实例.</h5></blockquote> <ul><li><p><strong>Worker上执行内容:  ==RDD的生成, RDD算子的执行==</strong></p></li> <li><p><strong>Driver上执行内容:  ==spark context生成, 变量的定义, print执行==.</strong></p></li> <li><h5 id="spark算子所接受的函数-本质上是一个闭包-因为其需要封闭作用域-并且序列化自身和依赖-分发到不同的节点中运行"><a href="#spark算子所接受的函数-本质上是一个闭包-因为其需要封闭作用域-并且序列化自身和依赖-分发到不同的节点中运行" class="header-anchor">#</a> Spark算子所接受的函数, 本质上是一个闭包, 因为其需要封闭作用域, 并且序列化自身和依赖, 分发到不同的节点中运行</h5></li></ul> <blockquote><h5 id="案例-2"><a href="#案例-2" class="header-anchor">#</a> 案例</h5></blockquote> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token keyword">class</span> MyClass <span class="token punctuation">{</span>
  <span class="token keyword">val</span> field <span class="token operator">=</span> <span class="token string">&quot;Hello&quot;</span>

  <span class="token keyword">def</span> doStuff<span class="token punctuation">(</span>rdd<span class="token operator">:</span> RDD<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> RDD<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    rdd<span class="token punctuation">.</span>map<span class="token punctuation">(</span>x <span class="token keyword">=&gt;</span> field <span class="token operator">+</span> x<span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br></div></div><blockquote><p>闭包就有了一个依赖, 依赖于外部的一个类, 因为传递给算子的函数最终要在 Executor 中运行, 所以需序列化 MyClass 发给每一个 Executor, 从而在 Executor 访问 MyClass 对象的属性.</p></blockquote> <h3 id="累加器"><a href="#累加器" class="header-anchor">#</a> 累加器</h3> <blockquote><h4 id="实现全局中进行累加计数"><a href="#实现全局中进行累加计数" class="header-anchor">#</a> 实现全局中进行累加计数</h4></blockquote> <p><strong>引出问题</strong></p> <blockquote><div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token keyword">val</span> config <span class="token operator">=</span> <span class="token keyword">new</span> SparkConf<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setAppName<span class="token punctuation">(</span><span class="token string">&quot;ip_ana&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setMaster<span class="token punctuation">(</span><span class="token string">&quot;local[6]&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">val</span> sc <span class="token operator">=</span> <span class="token keyword">new</span> SparkContext<span class="token punctuation">(</span>config<span class="token punctuation">)</span>
<span class="token keyword">var</span> count <span class="token operator">=</span> <span class="token number">0</span>

sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span>Seq<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">.</span>foreach<span class="token punctuation">(</span>count <span class="token operator">+=</span> _<span class="token punctuation">)</span>

println<span class="token punctuation">(</span>count<span class="token punctuation">)</span>   <span class="token comment">//结果为0</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br></div></div><p><strong>问题 :</strong>   程序打印的结果不是15，而是0.</p></blockquote> <p><strong>问题分析</strong></p> <ul><li><h5 id="count变量定义和println是在driver中执行的-foreach函数是属于rdd对象-是在executor中执行的-所以当count变量被在rdd中使用时-出现了变量的-跨域-问题-也就是闭包问题"><a href="#count变量定义和println是在driver中执行的-foreach函数是属于rdd对象-是在executor中执行的-所以当count变量被在rdd中使用时-出现了变量的-跨域-问题-也就是闭包问题" class="header-anchor">#</a> count变量定义和println是在driver中执行的;  foreach函数是属于rdd对象, 是在executor中执行的;  所以当count变量被在rdd中使用时, 出现了变量的“跨域”问题，也就是闭包问题.</h5></li></ul> <blockquote><p>由于count函数和在rdd对象的foreach函数是属于不同“闭包”;  传进foreach中的count是一个副本，初始值都为0; 不管副本如何变化, 都不会影响到main函数中的count, 所以最终打印出来的count为0.</p></blockquote> <h4 id="全局累加器"><a href="#全局累加器" class="header-anchor">#</a> 全局累加器</h4> <blockquote><p><strong>==Accumulators(累加器) 是一个只支持added(添加) 的分布式变量==</strong>, 可以在分布式环境下保持一致性, 并且能够做到高效的并发.</p></blockquote> <ul><li><h5 id="概念"><a href="#概念" class="header-anchor">#</a> 概念</h5> <ul><li><p>原生Spark支持数值型的累加器, 只能==<strong>实现求和，计数和平均值.</strong>==</p> <ul><li><strong>LongAccumulator</strong>用来累加整数型</li> <li><strong>DoubleAccumulator</strong>用来累加浮点型</li> <li><strong>CollectionAccumulator</strong>用来累加集合元素</li></ul></li> <li><h5 id="accumulator-是支持并发并行的"><a href="#accumulator-是支持并发并行的" class="header-anchor">#</a> Accumulator 是支持并发并行的</h5></li> <li><h5 id="累加器只能在driver端定义初始值和读取数据-在excutor端中更新数据"><a href="#累加器只能在driver端定义初始值和读取数据-在excutor端中更新数据" class="header-anchor">#</a> ==累加器只能在Driver端定义初始值和读取数据，在Excutor端中更新数据.==</h5></li></ul></li> <li><h5 id="应用场景"><a href="#应用场景" class="header-anchor">#</a> 应用场景</h5> <blockquote><h5 id="用来在spark-streaming应用中记录某些事件的数量"><a href="#用来在spark-streaming应用中记录某些事件的数量" class="header-anchor">#</a> 用来在Spark Streaming应用中记录某些事件的数量</h5></blockquote></li> <li><p>实现步骤</p> <ol><li><strong>通过调用 SparkContext.longAccumulator( ) 方法, 创建出存有初始值的累加器。</strong></li> <li><strong>在闭包函数体里调用add()方法, 增加累加器的值。</strong></li> <li><strong>通过调用value方法来访问累加器的值。</strong></li></ol></li></ul> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token keyword">val</span> config <span class="token operator">=</span> <span class="token keyword">new</span> SparkConf<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setAppName<span class="token punctuation">(</span><span class="token string">&quot;ip_ana&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setMaster<span class="token punctuation">(</span><span class="token string">&quot;local[6]&quot;</span><span class="token punctuation">)</span>
<span class="token keyword">val</span> sc <span class="token operator">=</span> <span class="token keyword">new</span> SparkContext<span class="token punctuation">(</span>config<span class="token punctuation">)</span>

<span class="token comment">//创建出存有初始值的累加器</span>
<span class="token keyword">val</span> counter <span class="token operator">=</span> sc<span class="token punctuation">.</span>longAccumulator<span class="token punctuation">(</span><span class="token string">&quot;counter&quot;</span><span class="token punctuation">)</span>

sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span>Seq<span class="token punctuation">(</span><span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">4</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
  <span class="token punctuation">.</span>foreach<span class="token punctuation">(</span>counter<span class="token punctuation">.</span>add<span class="token punctuation">(</span>_<span class="token punctuation">)</span><span class="token punctuation">)</span>  <span class="token comment">// 增加累加器的值</span>

<span class="token comment">// 访问累加器的值</span>
println<span class="token punctuation">(</span>counter<span class="token punctuation">.</span>value<span class="token punctuation">)</span>    
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br></div></div><h4 id="自定义累加器"><a href="#自定义累加器" class="header-anchor">#</a> 自定义累加器</h4> <blockquote><p>开发者可以通过自定义累加器来实现更多功能.</p></blockquote> <ul><li>实现步骤
<ol><li><strong>创建自定义累加器, 继承AccumulatorV2.</strong></li> <li><strong>重写多个方法</strong></li></ol></li></ul> <blockquote><p>需求:  把RDD的元素输出为set集合</p></blockquote> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token keyword">class</span> Accumulator <span class="token punctuation">{</span>

  <span class="token comment">/**
   * RDD -&gt; (1, 2, 3, 4, 5) -&gt; Set(1,2,3,4,5)
   */</span>
  <span class="token annotation punctuation">@Test</span>
  <span class="token keyword">def</span> acc<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token keyword">val</span> config <span class="token operator">=</span> <span class="token keyword">new</span> SparkConf<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setAppName<span class="token punctuation">(</span><span class="token string">&quot;acc&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setMaster<span class="token punctuation">(</span><span class="token string">&quot;local[6]&quot;</span><span class="token punctuation">)</span>
    <span class="token keyword">val</span> sc <span class="token operator">=</span> <span class="token keyword">new</span> SparkContext<span class="token punctuation">(</span>config<span class="token punctuation">)</span>

    <span class="token keyword">val</span> numAcc <span class="token operator">=</span> <span class="token keyword">new</span> NumAccumulator<span class="token punctuation">(</span><span class="token punctuation">)</span>
    <span class="token comment">// 注册给 Spark</span>
    sc<span class="token punctuation">.</span>register<span class="token punctuation">(</span>numAcc<span class="token punctuation">,</span> <span class="token string">&quot;num&quot;</span><span class="token punctuation">)</span>

    sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span>Seq<span class="token punctuation">(</span><span class="token string">&quot;1&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;2&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;3&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
      <span class="token punctuation">.</span>foreach<span class="token punctuation">(</span>item <span class="token keyword">=&gt;</span> numAcc<span class="token punctuation">.</span>add<span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">)</span>

    println<span class="token punctuation">(</span>numAcc<span class="token punctuation">.</span>value<span class="token punctuation">)</span>

    sc<span class="token punctuation">.</span>stop<span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>


<span class="token keyword">class</span> NumAccumulator <span class="token keyword">extends</span> AccumulatorV2<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span> Set<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token punctuation">{</span>
  <span class="token keyword">private</span> <span class="token keyword">val</span> nums<span class="token operator">:</span> mutable<span class="token punctuation">.</span>Set<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span> <span class="token operator">=</span> mutable<span class="token punctuation">.</span>Set<span class="token punctuation">(</span><span class="token punctuation">)</span>

  <span class="token comment">/**
   * 告诉 Spark 框架, 这个累加器对象是否是空的
   */</span>
  <span class="token keyword">override</span> <span class="token keyword">def</span> isZero<span class="token operator">:</span> <span class="token builtin">Boolean</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    nums<span class="token punctuation">.</span>isEmpty
  <span class="token punctuation">}</span>

  <span class="token comment">/**
   * 提供给 Spark 框架一个拷贝的累加器
   *
   * @return
   */</span>
  <span class="token keyword">override</span> <span class="token keyword">def</span> copy<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> AccumulatorV2<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span> Set<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    <span class="token keyword">val</span> newAccumulator <span class="token operator">=</span> <span class="token keyword">new</span> NumAccumulator<span class="token punctuation">(</span><span class="token punctuation">)</span>
    nums<span class="token punctuation">.</span>synchronized <span class="token punctuation">{</span>
      newAccumulator<span class="token punctuation">.</span>nums <span class="token operator">++</span><span class="token operator">=</span> <span class="token keyword">this</span><span class="token punctuation">.</span>nums
    <span class="token punctuation">}</span>
    newAccumulator
  <span class="token punctuation">}</span>

  <span class="token comment">/**
   * 帮助 Spark 框架, 清理累加器的内容
   */</span>
  <span class="token keyword">override</span> <span class="token keyword">def</span> reset<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    nums<span class="token punctuation">.</span>clear<span class="token punctuation">(</span><span class="token punctuation">)</span>
  <span class="token punctuation">}</span>

  <span class="token comment">/**
   * 外部传入要累加的内容, 在这个方法中进行累加
   */</span>
  <span class="token keyword">override</span> <span class="token keyword">def</span> add<span class="token punctuation">(</span>v<span class="token operator">:</span> <span class="token builtin">String</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    nums <span class="token operator">+=</span> v
  <span class="token punctuation">}</span>

  <span class="token comment">/**
   * 累加器在进行累加的时候, 可能每个分布式节点都有一个实例
   * 在最后 Driver 进行一次合并, 把所有的实例的内容合并起来, 会调用这个 merge 方法进行合并
   */</span>
  <span class="token keyword">override</span> <span class="token keyword">def</span> merge<span class="token punctuation">(</span>other<span class="token operator">:</span> AccumulatorV2<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span> Set<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    nums <span class="token operator">++</span><span class="token operator">=</span> other<span class="token punctuation">.</span>value
  <span class="token punctuation">}</span>

  <span class="token comment">/**
   * 提供给外部累加结果
   * 需要返回一个不可变的集合, 因为不能因为外部的修改而影响自身的值
   */</span>
  <span class="token keyword">override</span> <span class="token keyword">def</span> value<span class="token operator">:</span> Set<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
    nums<span class="token punctuation">.</span>toSet
  <span class="token punctuation">}</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br><span class="line-number">20</span><br><span class="line-number">21</span><br><span class="line-number">22</span><br><span class="line-number">23</span><br><span class="line-number">24</span><br><span class="line-number">25</span><br><span class="line-number">26</span><br><span class="line-number">27</span><br><span class="line-number">28</span><br><span class="line-number">29</span><br><span class="line-number">30</span><br><span class="line-number">31</span><br><span class="line-number">32</span><br><span class="line-number">33</span><br><span class="line-number">34</span><br><span class="line-number">35</span><br><span class="line-number">36</span><br><span class="line-number">37</span><br><span class="line-number">38</span><br><span class="line-number">39</span><br><span class="line-number">40</span><br><span class="line-number">41</span><br><span class="line-number">42</span><br><span class="line-number">43</span><br><span class="line-number">44</span><br><span class="line-number">45</span><br><span class="line-number">46</span><br><span class="line-number">47</span><br><span class="line-number">48</span><br><span class="line-number">49</span><br><span class="line-number">50</span><br><span class="line-number">51</span><br><span class="line-number">52</span><br><span class="line-number">53</span><br><span class="line-number">54</span><br><span class="line-number">55</span><br><span class="line-number">56</span><br><span class="line-number">57</span><br><span class="line-number">58</span><br><span class="line-number">59</span><br><span class="line-number">60</span><br><span class="line-number">61</span><br><span class="line-number">62</span><br><span class="line-number">63</span><br><span class="line-number">64</span><br><span class="line-number">65</span><br><span class="line-number">66</span><br><span class="line-number">67</span><br><span class="line-number">68</span><br><span class="line-number">69</span><br><span class="line-number">70</span><br><span class="line-number">71</span><br><span class="line-number">72</span><br><span class="line-number">73</span><br><span class="line-number">74</span><br><span class="line-number">75</span><br><span class="line-number">76</span><br><span class="line-number">77</span><br></div></div><h3 id="广播变量"><a href="#广播变量" class="header-anchor">#</a> 广播变量*</h3> <blockquote><h4 id="优化变量共享的性能"><a href="#优化变量共享的性能" class="header-anchor">#</a> 优化变量共享的性能</h4></blockquote> <p><strong>BlockManager</strong></p> <blockquote><p><strong>概念:</strong>  负责管理某个Executor对应的内存和磁盘上的数据.</p></blockquote> <h4 id="广播变量的原理"><a href="#广播变量的原理" class="header-anchor">#</a> 广播变量的原理</h4> <blockquote><p>广播变量，初始的时候，就在Drvier上有一份副本。task在运行的时候，想要使用广播变量中的数据，此时首先会在自己本地的Executor对应的BlockManager中，尝试获取变量副本；如果本地没有，那么就从Driver远程拉取变量副本，并保存在本地的BlockManager中；此后这个executor上的task，都会直接使用本地的BlockManager中的副本。executor的BlockManager除了从driver上拉取，也可能从其他节点的BlockManager上拉取变量副本。</p></blockquote> <h4 id="广播变量作用"><a href="#广播变量作用" class="header-anchor">#</a> 广播变量作用</h4> <ul><li>广播变量的作用就是不需要每个task带上一份变量副本, 而是变成**==每个节点的executor才有一份副本.==**</li> <li>广播变量**==只能在 Driver 端定义和修改==**，不能在 Executor 端定义和修改.</li></ul> <h4 id="广播变量适用场景"><a href="#广播变量适用场景" class="header-anchor">#</a> 广播变量适用场景</h4> <ul><li>一个变量的数据量较大的时候</li> <li>一个Executor中有多个Task的时候</li></ul> <h4 id="广播变量api"><a href="#广播变量api" class="header-anchor">#</a> 广播变量API</h4> <table><thead><tr><th style="text-align:left;">方法名</th> <th style="text-align:left;">描述</th></tr></thead> <tbody><tr><td style="text-align:left;"><strong>id</strong></td> <td style="text-align:left;">唯一标识</td></tr> <tr><td style="text-align:left;"><strong>value</strong></td> <td style="text-align:left;">广播变量的值</td></tr> <tr><td style="text-align:left;"><strong>unpersist</strong></td> <td style="text-align:left;">在 Executor 中异步的删除缓存副本</td></tr> <tr><td style="text-align:left;"><strong>destroy</strong></td> <td style="text-align:left;">销毁所有此广播变量所关联的数据和元数据</td></tr> <tr><td style="text-align:left;"><strong>toString</strong></td> <td style="text-align:left;">字符串表示</td></tr></tbody></table> <ul><li><h5 id="实现步骤-2"><a href="#实现步骤-2" class="header-anchor">#</a> 实现步骤</h5> <ol><li>通过对一个类型 T 的对象调用 SparkContext.<strong>broadcast</strong> 创建出一个Broadcast[T] 对象</li> <li><strong>通过 value 属性访问该对象的值</strong></li> <li>变量只会被发到各个节点一次，应作为只读值处理(修改这个值不会影响到别的节点).</li></ol></li></ul> <div class="language-scala line-numbers-mode"><pre class="language-scala"><code><span class="token keyword">def</span> test<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token operator">:</span> <span class="token builtin">Unit</span> <span class="token operator">=</span> <span class="token punctuation">{</span>
  <span class="token keyword">val</span> config <span class="token operator">=</span> <span class="token keyword">new</span> SparkConf<span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setMaster<span class="token punctuation">(</span><span class="token string">&quot;local[6]&quot;</span><span class="token punctuation">)</span><span class="token punctuation">.</span>setAppName<span class="token punctuation">(</span><span class="token string">&quot;test&quot;</span><span class="token punctuation">)</span>
  <span class="token keyword">val</span> sc <span class="token operator">=</span> <span class="token keyword">new</span> SparkContext<span class="token punctuation">(</span>config<span class="token punctuation">)</span>
    
  <span class="token comment">// 数据, 假装这个数据很大, 大概一百兆</span>
  <span class="token keyword">val</span> v<span class="token operator">:</span> Map<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token builtin">String</span><span class="token punctuation">]</span> <span class="token operator">=</span> Map<span class="token punctuation">(</span><span class="token string">&quot;Spark&quot;</span> <span class="token operator">-&gt;</span> <span class="token string">&quot;http://spark.apache.cn&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Scala&quot;</span> <span class="token operator">-&gt;</span> <span class="token string">&quot;http://www.scala-lang.org&quot;</span><span class="token punctuation">)</span>
    
  <span class="token comment">// 创建广播</span>
  <span class="token keyword">val</span> b<span class="token operator">:</span> broadcast<span class="token punctuation">.</span>Broadcast<span class="token punctuation">[</span>Map<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">,</span> <span class="token builtin">String</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> sc<span class="token punctuation">.</span>broadcast<span class="token punctuation">(</span>v<span class="token punctuation">)</span>
  
  <span class="token comment">// 将其中的 Spark 和 Scala 转为对应的网址</span>
  <span class="token keyword">val</span> r<span class="token operator">:</span> RDD<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span> <span class="token operator">=</span> sc<span class="token punctuation">.</span>parallelize<span class="token punctuation">(</span>Seq<span class="token punctuation">(</span><span class="token string">&quot;Spark&quot;</span><span class="token punctuation">,</span> <span class="token string">&quot;Scala&quot;</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
    
  <span class="token comment">// 在算子中使用广播变量代替直接引用集合, 只会复制和executor一样的数量</span>
  <span class="token comment">// 在使用广播之前, 复制 map 了 task 数量份</span>
  <span class="token comment">// 在使用广播以后, 复制次数和 executor 数量一致</span>
  <span class="token keyword">val</span> result<span class="token operator">:</span> Array<span class="token punctuation">[</span><span class="token builtin">String</span><span class="token punctuation">]</span> <span class="token operator">=</span> r<span class="token punctuation">.</span>map<span class="token punctuation">(</span>item <span class="token keyword">=&gt;</span> b<span class="token punctuation">.</span>value<span class="token punctuation">(</span>item<span class="token punctuation">)</span><span class="token punctuation">)</span><span class="token punctuation">.</span>collect<span class="token punctuation">(</span><span class="token punctuation">)</span>
  result<span class="token punctuation">.</span>foreach<span class="token punctuation">(</span>println<span class="token punctuation">(</span>_<span class="token punctuation">)</span><span class="token punctuation">)</span>
<span class="token punctuation">}</span>
</code></pre> <div class="line-numbers-wrapper"><span class="line-number">1</span><br><span class="line-number">2</span><br><span class="line-number">3</span><br><span class="line-number">4</span><br><span class="line-number">5</span><br><span class="line-number">6</span><br><span class="line-number">7</span><br><span class="line-number">8</span><br><span class="line-number">9</span><br><span class="line-number">10</span><br><span class="line-number">11</span><br><span class="line-number">12</span><br><span class="line-number">13</span><br><span class="line-number">14</span><br><span class="line-number">15</span><br><span class="line-number">16</span><br><span class="line-number">17</span><br><span class="line-number">18</span><br><span class="line-number">19</span><br></div></div></div></section> <footer class="page-edit"><!----> <div class="last-updated"><span class="prefix">Last Updated: </span> <span class="time">2023/5/26 03:36:57</span></div></footer> <div class="page-nav"><p class="inner"><span class="prev"><a href="/2020/05/28/plugin/" class="prev">
          plugin
        </a></span> <!----></p></div> <div class="comments-wrapper"><!----></div></main></div> <!----></div> <ul class="sub-sidebar sub-sidebar-wrapper" style="width:12rem;" data-v-b57cc07c data-v-7dd95ae2><li class="level-2" data-v-b57cc07c><a href="/test/#spark概述" class="sidebar-link reco-side-spark概述" data-v-b57cc07c>Spark概述</a></li><li class="level-3" data-v-b57cc07c><a href="/test/#spark组件" class="sidebar-link reco-side-spark组件" data-v-b57cc07c>Spark组件</a></li><li class="level-3" data-v-b57cc07c><a href="/test/#spark和hadoop的异同" class="sidebar-link reco-side-spark和hadoop的异同" data-v-b57cc07c>Spark和Hadoop的异同</a></li><li class="level-3" data-v-b57cc07c><a href="/test/#spark集群结构" class="sidebar-link reco-side-spark集群结构" data-v-b57cc07c>Spark集群结构</a></li><li class="level-2" data-v-b57cc07c><a href="/test/#spark入门" class="sidebar-link reco-side-spark入门" data-v-b57cc07c>Spark入门</a></li><li class="level-3" data-v-b57cc07c><a href="/test/#spark-shell的方式编写wordcount" class="sidebar-link reco-side-spark-shell的方式编写wordcount" data-v-b57cc07c>Spark shell的方式编写WordCount</a></li><li class="level-3" data-v-b57cc07c><a href="/test/#读取-hdfs-上的文件" class="sidebar-link reco-side-读取-hdfs-上的文件" data-v-b57cc07c>读取 HDFS 上的文件</a></li><li class="level-3" data-v-b57cc07c><a href="/test/#编写独立应用提交spark任务" class="sidebar-link reco-side-编写独立应用提交spark任务" data-v-b57cc07c>编写独立应用提交Spark任务</a></li><li class="level-2" data-v-b57cc07c><a href="/test/#rdd概念" class="sidebar-link reco-side-rdd概念" data-v-b57cc07c>RDD概念</a></li><li class="level-3" data-v-b57cc07c><a href="/test/#_1-rdd是什么" class="sidebar-link reco-side-_1-rdd是什么" data-v-b57cc07c>1. RDD是什么</a></li><li class="level-3" data-v-b57cc07c><a href="/test/#_2-创建rdd" class="sidebar-link reco-side-_2-创建rdd" data-v-b57cc07c>2. 创建RDD</a></li><li class="level-3" data-v-b57cc07c><a href="/test/#_3-rdd算子" class="sidebar-link reco-side-_3-rdd算子" data-v-b57cc07c>3. RDD算子</a></li><li class="level-2" data-v-b57cc07c><a href="/test/#rdd算子" class="sidebar-link reco-side-rdd算子" data-v-b57cc07c>RDD算子</a></li><li class="level-3" data-v-b57cc07c><a href="/test/#_1-rdd算子分类和特点" class="sidebar-link reco-side-_1-rdd算子分类和特点" data-v-b57cc07c>1. RDD算子分类和特点</a></li><li class="level-3" data-v-b57cc07c><a href="/test/#_2-transformations-算子" class="sidebar-link reco-side-_2-transformations-算子" data-v-b57cc07c>2. Transformations 算子</a></li><li class="level-3" data-v-b57cc07c><a href="/test/#_3-action-算子" class="sidebar-link reco-side-_3-action-算子" data-v-b57cc07c>3. Action 算子</a></li><li class="level-3" data-v-b57cc07c><a href="/test/#_4-rdd对不同类型数据的支持" class="sidebar-link reco-side-_4-rdd对不同类型数据的支持" data-v-b57cc07c>4. RDD对不同类型数据的支持</a></li><li class="level-2" data-v-b57cc07c><a href="/test/#rdd缓存" class="sidebar-link reco-side-rdd缓存" data-v-b57cc07c>RDD缓存</a></li><li class="level-3" data-v-b57cc07c><a href="/test/#缓存的意义" class="sidebar-link reco-side-缓存的意义" data-v-b57cc07c>缓存的意义</a></li><li class="level-3" data-v-b57cc07c><a href="/test/#缓存api" class="sidebar-link reco-side-缓存api" data-v-b57cc07c>缓存API</a></li><li class="level-3" data-v-b57cc07c><a href="/test/#缓存级别" class="sidebar-link reco-side-缓存级别" data-v-b57cc07c>缓存级别</a></li><li class="level-2" data-v-b57cc07c><a href="/test/#checkpoint" class="sidebar-link reco-side-checkpoint" data-v-b57cc07c>Checkpoint</a></li><li class="level-3" data-v-b57cc07c><a href="/test/#checkpoint的作用" class="sidebar-link reco-side-checkpoint的作用" data-v-b57cc07c>Checkpoint的作用</a></li><li class="level-3" data-v-b57cc07c><a href="/test/#checkpoint的方式" class="sidebar-link reco-side-checkpoint的方式" data-v-b57cc07c>Checkpoint的方式</a></li><li class="level-3" data-v-b57cc07c><a href="/test/#checkpoint和cache的区别" class="sidebar-link reco-side-checkpoint和cache的区别" data-v-b57cc07c>Checkpoint和Cache的区别</a></li><li class="level-3" data-v-b57cc07c><a href="/test/#checkpoint的使用" class="sidebar-link reco-side-checkpoint的使用" data-v-b57cc07c>Checkpoint的使用</a></li><li class="level-2" data-v-b57cc07c><a href="/test/#spark分布式共享变量" class="sidebar-link reco-side-spark分布式共享变量" data-v-b57cc07c>Spark分布式共享变量</a></li><li class="level-3" data-v-b57cc07c><a href="/test/#spark闭包分发" class="sidebar-link reco-side-spark闭包分发" data-v-b57cc07c>spark闭包分发</a></li><li class="level-3" data-v-b57cc07c><a href="/test/#累加器" class="sidebar-link reco-side-累加器" data-v-b57cc07c>累加器</a></li><li class="level-3" data-v-b57cc07c><a href="/test/#广播变量" class="sidebar-link reco-side-广播变量" data-v-b57cc07c>广播变量*</a></li></ul></div></div></div><div class="global-ui"><div class="back-to-ceiling" style="right:1rem;bottom:6rem;width:2.5rem;height:2.5rem;border-radius:.25rem;line-height:2.5rem;display:none;" data-v-c6073ba8 data-v-c6073ba8><svg t="1574745035067" viewBox="0 0 1024 1024" version="1.1" xmlns="http://www.w3.org/2000/svg" p-id="5404" class="icon" data-v-c6073ba8><path d="M526.60727968 10.90185116a27.675 27.675 0 0 0-29.21455937 0c-131.36607665 82.28402758-218.69155461 228.01873535-218.69155402 394.07834331a462.20625001 462.20625001 0 0 0 5.36959153 69.94390903c1.00431239 6.55289093-0.34802892 13.13561351-3.76865779 18.80351572-32.63518765 54.11355614-51.75690182 118.55860487-51.7569018 187.94566865a371.06718723 371.06718723 0 0 0 11.50484808 91.98906777c6.53300375 25.50556257 41.68394495 28.14064038 52.69160883 4.22606766 17.37162448-37.73630017 42.14135425-72.50938081 72.80769204-103.21549295 2.18761121 3.04276886 4.15646224 6.24463696 6.40373557 9.22774369a1871.4375 1871.4375 0 0 0 140.04691725 5.34970492 1866.36093723 1866.36093723 0 0 0 140.04691723-5.34970492c2.24727335-2.98310674 4.21612437-6.18497483 6.3937923-9.2178004 30.66633723 30.70611158 55.4360664 65.4791928 72.80769147 103.21549355 11.00766384 23.91457269 46.15860503 21.27949489 52.69160879-4.22606768a371.15156223 371.15156223 0 0 0 11.514792-91.99901164c0-69.36717486-19.13165746-133.82216804-51.75690182-187.92578088-3.42062944-5.66790279-4.76302748-12.26056868-3.76865837-18.80351632a462.20625001 462.20625001 0 0 0 5.36959269-69.943909c-0.00994388-166.08943902-87.32547796-311.81420293-218.6915546-394.09823051zM605.93803103 357.87693858a93.93749974 93.93749974 0 1 1-187.89594924 6.1e-7 93.93749974 93.93749974 0 0 1 187.89594924-6.1e-7z" p-id="5405" data-v-c6073ba8></path><path d="M429.50777625 765.63860547C429.50777625 803.39355007 466.44236686 1000.39046097 512.00932183 1000.39046097c45.56695499 0 82.4922232-197.00623328 82.5015456-234.7518555 0-37.75494459-36.9345906-68.35043303-82.4922232-68.34111062-45.57627738-0.00932239-82.52019037 30.59548842-82.51086798 68.34111062z" p-id="5406" data-v-c6073ba8></path></svg></div></div></div>
    <script src="/assets/js/app.b82542a7.js" defer></script><script src="/assets/js/3.3eaabea3.js" defer></script><script src="/assets/js/1.67511a4e.js" defer></script><script src="/assets/js/18.74b5b17a.js" defer></script>
  </body>
</html>
